"use strict";(()=>{var e={};e.id=688,e.ids=[688],e.modules={19993:e=>{e.exports=require("googleapis")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},58199:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var r={};a.r(r),a.d(r,{GET:()=>p});var i=a(49303),o=a(88716),s=a(60670),n=a(87070),l=a(19993),u=a(37007);let c=u.Z.firestore();async function p(e){let t=new URL(e.url).searchParams.get("code");if(!t)return n.NextResponse.json({error:"Authorization code not found"},{status:400});if(!process.env.GOOGLE_CLIENT_ID||!process.env.GOOGLE_CLIENT_SECRET)return console.error("Missing Google OAuth environment variables"),n.NextResponse.json({error:"Server configuration error"},{status:500});try{let e;let a=new l.google.auth.OAuth2(process.env.GOOGLE_CLIENT_ID,process.env.GOOGLE_CLIENT_SECRET,"https://special-space-train-5gwv7gwxq56f5p5-3000.app.github.dev/api/auth/google/callback"),{tokens:r}=await a.getToken(t);a.setCredentials(r);let i=l.google.oauth2({version:"v2",auth:a}),{data:o}=await i.userinfo.get();if(!o.id||!o.email)throw Error("Failed to retrieve user information from Google.");try{e=await u.Z.auth().getUserByEmail(o.email),await u.Z.auth().updateUser(e.uid,{displayName:o.name,photoURL:o.picture})}catch(t){if("auth/user-not-found"===t.code)e=await u.Z.auth().createUser({email:o.email,emailVerified:!!o.verified_email,displayName:o.name,photoURL:o.picture});else throw t}if(r.refresh_token){let t=c.collection("users").doc(e.uid);await t.set({refreshToken:r.refresh_token,googleId:o.id},{merge:!0})}let s=await u.Z.auth().createCustomToken(e.uid),p=new URL("/auth/callback","https://special-space-train-5gwv7gwxq56f5p5-3000.app.github.dev");return p.searchParams.set("token",s),n.NextResponse.redirect(p)}catch(t){console.error("Callback error:",t);let e=new URL("/","https://special-space-train-5gwv7gwxq56f5p5-3000.app.github.dev");return e.searchParams.set("error","auth_failed"),n.NextResponse.redirect(e)}}let d=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/google/callback/route",pathname:"/api/auth/google/callback",filename:"route",bundlePath:"app/api/auth/google/callback/route"},resolvedPagePath:"/workspaces/ByggPilot/src/app/api/auth/google/callback/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:m}=d,f="/api/auth/google/callback/route";function v(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},37007:(e,t,a)=>{a.d(t,{Z:()=>o});let r=require("firebase-admin");var i=a.n(r);if(!i().apps.length)try{i().initializeApp({credential:i().credential.applicationDefault()}),console.log("Firebase Admin SDK initialized successfully using Application Default Credentials.")}catch(e){throw console.error("CRITICAL: Firebase Admin SDK initialization failed.",e.stack),Error("Could not initialize Firebase Admin SDK. Check server logs.")}let o=i()}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,972],()=>a(58199));module.exports=r})();