"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27724:(e,t,r)=>{let a,n;r.r(t),r.d(t,{originalPathname:()=>sj,patchFetch:()=>sM,requestAsyncStorage:()=>sO,routeModule:()=>sN,serverHooks:()=>sP,staticGenerationAsyncStorage:()=>sR});var s,i,o,l,u,d,c,p,m,h,f,g,y,v,_,x,b,k,w,T,I,S,A,E,C,N,O,R,P,j,M,D={};r.r(D),r.d(D,{POST:()=>sC});var $=r(49303),Z=r(88716),L=r(60670),F="vercel.ai.error",U=Symbol.for(F),q=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[s]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,F)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}};s=U;var B=q,V="AI_APICallError",z=`vercel.ai.error.${V}`,J=Symbol.for(z),K=class extends B{constructor({message:e,url:t,requestBodyValues:r,statusCode:a,responseHeaders:n,responseBody:s,cause:o,isRetryable:l=null!=a&&(408===a||409===a||429===a||a>=500),data:u}){super({name:V,message:e,cause:o}),this[i]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=a,this.responseHeaders=n,this.responseBody=s,this.isRetryable=l,this.data=u}static isInstance(e){return B.hasMarker(e,z)}};i=J;var W="AI_EmptyResponseBodyError",G=`vercel.ai.error.${W}`,Y=Symbol.for(G),H=class extends B{constructor({message:e="Empty response body"}={}){super({name:W,message:e}),this[o]=!0}static isInstance(e){return B.hasMarker(e,G)}};function Q(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}o=Y;var X="AI_InvalidArgumentError",ee=`vercel.ai.error.${X}`,et=Symbol.for(ee),er=class extends B{constructor({message:e,cause:t,argument:r}){super({name:X,message:e,cause:t}),this[l]=!0,this.argument=r}static isInstance(e){return B.hasMarker(e,ee)}};l=et;var ea="AI_InvalidPromptError",en=`vercel.ai.error.${ea}`,es=Symbol.for(en),ei=class extends B{constructor({prompt:e,message:t,cause:r}){super({name:ea,message:`Invalid prompt: ${t}`,cause:r}),this[u]=!0,this.prompt=e}static isInstance(e){return B.hasMarker(e,en)}};u=es,Symbol.for("vercel.ai.error.AI_InvalidResponseDataError");var eo="AI_JSONParseError",el=`vercel.ai.error.${eo}`,eu=Symbol.for(el),ed=class extends B{constructor({text:e,cause:t}){super({name:eo,message:`JSON parsing failed: Text: ${e}.
Error message: ${Q(t)}`,cause:t}),this[d]=!0,this.text=e}static isInstance(e){return B.hasMarker(e,el)}};d=eu;var ec="AI_LoadAPIKeyError",ep=`vercel.ai.error.${ec}`,em=Symbol.for(ep),eh=class extends B{constructor({message:e}){super({name:ec,message:e}),this[c]=!0}static isInstance(e){return B.hasMarker(e,ep)}};c=em,Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError");var ef="AI_NoSuchModelError",eg=`vercel.ai.error.${ef}`,ey=Symbol.for(eg),ev=class extends B{constructor({errorName:e=ef,modelId:t,modelType:r,message:a=`No such ${r}: ${t}`}){super({name:e,message:a}),this[p]=!0,this.modelId=t,this.modelType=r}static isInstance(e){return B.hasMarker(e,eg)}};p=ey;var e_="AI_TooManyEmbeddingValuesForCallError",ex=`vercel.ai.error.${e_}`,eb=Symbol.for(ex),ek=class extends B{constructor(e){super({name:e_,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[m]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return B.hasMarker(e,ex)}};m=eb;var ew="AI_TypeValidationError",eT=`vercel.ai.error.${ew}`,eI=Symbol.for(eT),eS=class e extends B{constructor({value:e,cause:t}){super({name:ew,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${Q(t)}`,cause:t}),this[h]=!0,this.value=e}static isInstance(e){return B.hasMarker(e,eT)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}};h=eI;var eA="AI_UnsupportedFunctionalityError",eE=`vercel.ai.error.${eA}`,eC=Symbol.for(eE),eN=class extends B{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:eA,message:t}),this[f]=!0,this.functionality=e}static isInstance(e){return B.hasMarker(e,eE)}};function eO(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(eO):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&eO(t)))}f=eC;let eR=(e,t=21)=>(r=t)=>{let a="",n=0|r;for(;n--;)a+=e[Math.random()*e.length|0];return a};var eP=r(45762);function ej(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}async function eM(e){return null==e?Promise.resolve():new Promise(t=>setTimeout(t,e))}function eD(e){let t={};return e.headers.forEach((e,r)=>{t[r]=e}),t}var e$=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{let n=eR(r,t);if(null==e)return n;if(r.includes(a))throw new er({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return t=>`${e}${a}${n(t)}`},eZ=e$();function eL(e){return e instanceof Error&&("AbortError"===e.name||"TimeoutError"===e.name)}var eF=Symbol.for("vercel.ai.validator");function eU({value:e,schema:t}){let r="object"==typeof t&&null!==t&&eF in t&&!0===t[eF]&&"validate"in t?t:{[eF]:!0,validate:e=>{let r=t.safeParse(e);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}};try{if(null==r.validate)return{success:!0,value:e};let t=r.validate(e);if(t.success)return t;return{success:!1,error:eS.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:eS.wrap({value:e,cause:t})}}}function eq({text:e,schema:t}){try{let r=eP.parse(e);if(null==t)return{success:!0,value:r,rawValue:r};let a=eU({value:r,schema:t});return a.success?{...a,rawValue:r}:a}catch(t){return{success:!1,error:ed.isInstance(t)?t:new ed({text:e,cause:t})}}}var eB=()=>globalThis.fetch,eV=async({url:e,headers:t,body:r,failedResponseHandler:a,successfulResponseHandler:n,abortSignal:s,fetch:i})=>ez({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:a,successfulResponseHandler:n,abortSignal:s,fetch:i}),ez=async({url:e,headers:t={},body:r,successfulResponseHandler:a,failedResponseHandler:n,abortSignal:s,fetch:i=eB()})=>{try{let o=await i(e,{method:"POST",headers:Object.fromEntries(Object.entries(t).filter(([e,t])=>null!=t)),body:r.content,signal:s}),l=eD(o);if(!o.ok){let t;try{t=await n({response:o,url:e,requestBodyValues:r.values})}catch(t){if(eL(t)||K.isInstance(t))throw t;throw new K({message:"Failed to process error response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}throw t.value}try{return await a({response:o,url:e,requestBodyValues:r.values})}catch(t){if(t instanceof Error&&(eL(t)||K.isInstance(t)))throw t;throw new K({message:"Failed to process successful response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}}catch(t){if(eL(t))throw t;if(t instanceof TypeError&&"fetch failed"===t.message){let a=t.cause;if(null!=a)throw new K({message:`Cannot connect to API: ${a.message}`,cause:a,url:e,requestBodyValues:r.values,isRetryable:!0})}throw t}};async function eJ(e){return"function"==typeof e&&(e=e()),Promise.resolve(e)}var eK=e=>async({response:t})=>{let r=eD(t);if(null==t.body)throw new H({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(function(){let e,t,r,a="",n=[];function s(e,t){if(""===e){i(t);return}if(e.startsWith(":"))return;let r=e.indexOf(":");if(-1===r){o(e,"");return}let a=e.slice(0,r),n=r+1;o(a,n<e.length&&" "===e[n]?e.slice(n+1):e.slice(n))}function i(a){n.length>0&&(a.enqueue({event:e,data:n.join("\n"),id:t,retry:r}),n=[],e=void 0,r=void 0)}function o(a,s){switch(a){case"event":e=s;break;case"data":n.push(s);break;case"id":t=s;break;case"retry":let i=parseInt(s,10);isNaN(i)||(r=i)}}return new TransformStream({transform(e,t){let{lines:r,incompleteLine:n}=function(e,t){let r=[],a=e;for(let e=0;e<t.length;){let n=t[e++];"\n"===n?(r.push(a),a=""):"\r"===n?(r.push(a),a="","\n"===t[e]&&e++):a+=n}return{lines:r,incompleteLine:a}}(a,e);a=n;for(let e=0;e<r.length;e++)s(r[e],t)},flush(e){s(a,e),i(e)}})}()).pipeThrough(new TransformStream({transform({data:t},r){"[DONE]"!==t&&r.enqueue(eq({text:t,schema:e}))}}))}},eW=e=>async({response:t,url:r,requestBodyValues:a})=>{let n=await t.text(),s=eq({text:n,schema:e}),i=eD(t);if(!s.success)throw new K({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:i,responseBody:n,url:r,requestBodyValues:a});return{responseHeaders:i,value:s.value,rawValue:s.rawValue}},{btoa:eG,atob:eY}=globalThis;function eH(e){let t=eY(e.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(t,e=>e.codePointAt(0))}function eQ(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return eG(t)}var eX=r(75658),e0=r(73048);(function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t})(g||(g={})),(y||(y={})).mergeShapes=(e,t)=>({...e,...t});let e1=g.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),e4=e=>{switch(typeof e){case"undefined":return e1.undefined;case"string":return e1.string;case"number":return Number.isNaN(e)?e1.nan:e1.number;case"boolean":return e1.boolean;case"function":return e1.function;case"bigint":return e1.bigint;case"symbol":return e1.symbol;case"object":if(Array.isArray(e))return e1.array;if(null===e)return e1.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return e1.promise;if("undefined"!=typeof Map&&e instanceof Map)return e1.map;if("undefined"!=typeof Set&&e instanceof Set)return e1.set;if("undefined"!=typeof Date&&e instanceof Date)return e1.date;return e1.object;default:return e1.unknown}},e9=g.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class e2 extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(let n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(a);else if("invalid_return_type"===n.code)a(n.returnTypeError);else if("invalid_arguments"===n.code)a(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,a=0;for(;a<n.path.length;){let r=n.path[a];a===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}static assert(e){if(!(e instanceof e2))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,g.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let a of this.issues)if(a.path.length>0){let r=a.path[0];t[r]=t[r]||[],t[r].push(e(a))}else r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}e2.create=e=>new e2(e);let e6=(e,t)=>{let r;switch(e.code){case e9.invalid_type:r=e.received===e1.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case e9.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,g.jsonStringifyReplacer)}`;break;case e9.unrecognized_keys:r=`Unrecognized key(s) in object: ${g.joinValues(e.keys,", ")}`;break;case e9.invalid_union:r="Invalid input";break;case e9.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${g.joinValues(e.options)}`;break;case e9.invalid_enum_value:r=`Invalid enum value. Expected ${g.joinValues(e.options)}, received '${e.received}'`;break;case e9.invalid_arguments:r="Invalid function arguments";break;case e9.invalid_return_type:r="Invalid function return type";break;case e9.invalid_date:r="Invalid date";break;case e9.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:g.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case e9.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case e9.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case e9.custom:r="Invalid input";break;case e9.invalid_intersection_types:r="Intersection results could not be merged";break;case e9.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case e9.not_finite:r="Number must be finite";break;default:r=t.defaultError,g.assertNever(e)}return{message:r}};!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(v||(v={}));let e5=e=>{let{data:t,path:r,errorMaps:a,issueData:n}=e,s=[...r,...n.path||[]],i={...n,path:s};if(void 0!==n.message)return{...n,path:s,message:n.message};let o="";for(let e of a.filter(e=>!!e).slice().reverse())o=e(i,{data:t,defaultError:o}).message;return{...n,path:s,message:o}};function e7(e,t){let r=e5({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,e6,e6==e6?void 0:e6].filter(e=>!!e)});e.common.issues.push(r)}class e3{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if("aborted"===a.status)return e8;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,a=await e.value;r.push({key:t,value:a})}return e3.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:t,value:n}=a;if("aborted"===t.status||"aborted"===n.status)return e8;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==n.value||a.alwaysSet)&&(r[t.value]=n.value)}return{status:e.value,value:r}}}let e8=Object.freeze({status:"aborted"}),te=e=>({status:"dirty",value:e}),tt=e=>({status:"valid",value:e}),tr=e=>"aborted"===e.status,ta=e=>"dirty"===e.status,tn=e=>"valid"===e.status,ts=e=>"undefined"!=typeof Promise&&e instanceof Promise;class ti{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let to=(e,t)=>{if(tn(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new e2(e.common.issues);return this._error=t,this._error}}};function tl(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:n}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{let{message:s}=e;return"invalid_enum_value"===t.code?{message:s??n.defaultError}:void 0===n.data?{message:s??a??n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:s??r??n.defaultError}},description:n}}class tu{get description(){return this._def.description}_getType(e){return e4(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:e4(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new e3,ctx:{common:e.parent.common,data:e.data,parsedType:e4(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(ts(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:e4(e)},a=this._parseSync({data:e,path:r.path,parent:r});return to(r,a)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:e4(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return tn(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>tn(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:e4(e)},a=this._parse({data:e,path:r.path,parent:r});return to(r,await (ts(a)?a:Promise.resolve(a)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{let n=e(t),s=()=>a.addIssue({code:e9.custom,...r(t)});return"undefined"!=typeof Promise&&n instanceof Promise?n.then(e=>!!e||(s(),!1)):!!n||(s(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new t4({schema:this,typeName:_.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return t9.create(this,this._def)}nullable(){return t2.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return tL.create(this)}promise(){return t1.create(this,this._def)}or(e){return tU.create([this,e],this._def)}and(e){return tV.create(this,e,this._def)}transform(e){return new t4({...tl(this._def),schema:this,typeName:_.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new t6({...tl(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:_.ZodDefault})}brand(){return new t3({typeName:_.ZodBranded,type:this,...tl(this._def)})}catch(e){return new t5({...tl(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:_.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return t8.create(this,e)}readonly(){return re.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let td=/^c[^\s-]{8,}$/i,tc=/^[0-9a-z]+$/,tp=/^[0-9A-HJKMNP-TV-Z]{26}$/i,tm=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,th=/^[a-z0-9_-]{21}$/i,tf=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,tg=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ty=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,tv=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,t_=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,tx=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,tb=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,tk=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,tw=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,tT="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",tI=RegExp(`^${tT}$`);function tS(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}class tA extends tu{_parse(e){var t,r,n,s;let i;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==e1.string){let t=this._getOrReturnCtx(e);return e7(t,{code:e9.invalid_type,expected:e1.string,received:t.parsedType}),e8}let o=new e3;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(e7(i=this._getOrReturnCtx(e,i),{code:e9.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("max"===l.kind)e.data.length>l.value&&(e7(i=this._getOrReturnCtx(e,i),{code:e9.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("length"===l.kind){let t=e.data.length>l.value,r=e.data.length<l.value;(t||r)&&(i=this._getOrReturnCtx(e,i),t?e7(i,{code:e9.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):r&&e7(i,{code:e9.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),o.dirty())}else if("email"===l.kind)ty.test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{validation:"email",code:e9.invalid_string,message:l.message}),o.dirty());else if("emoji"===l.kind)a||(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a.test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{validation:"emoji",code:e9.invalid_string,message:l.message}),o.dirty());else if("uuid"===l.kind)tm.test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{validation:"uuid",code:e9.invalid_string,message:l.message}),o.dirty());else if("nanoid"===l.kind)th.test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{validation:"nanoid",code:e9.invalid_string,message:l.message}),o.dirty());else if("cuid"===l.kind)td.test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{validation:"cuid",code:e9.invalid_string,message:l.message}),o.dirty());else if("cuid2"===l.kind)tc.test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{validation:"cuid2",code:e9.invalid_string,message:l.message}),o.dirty());else if("ulid"===l.kind)tp.test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{validation:"ulid",code:e9.invalid_string,message:l.message}),o.dirty());else if("url"===l.kind)try{new URL(e.data)}catch{e7(i=this._getOrReturnCtx(e,i),{validation:"url",code:e9.invalid_string,message:l.message}),o.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{validation:"regex",code:e9.invalid_string,message:l.message}),o.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(e7(i=this._getOrReturnCtx(e,i),{code:e9.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),o.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(e7(i=this._getOrReturnCtx(e,i),{code:e9.invalid_string,validation:{startsWith:l.value},message:l.message}),o.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(e7(i=this._getOrReturnCtx(e,i),{code:e9.invalid_string,validation:{endsWith:l.value},message:l.message}),o.dirty()):"datetime"===l.kind?(function(e){let t=`${tT}T${tS(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)})(l).test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{code:e9.invalid_string,validation:"datetime",message:l.message}),o.dirty()):"date"===l.kind?tI.test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{code:e9.invalid_string,validation:"date",message:l.message}),o.dirty()):"time"===l.kind?RegExp(`^${tS(l)}$`).test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{code:e9.invalid_string,validation:"time",message:l.message}),o.dirty()):"duration"===l.kind?tg.test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{validation:"duration",code:e9.invalid_string,message:l.message}),o.dirty()):"ip"===l.kind?(t=e.data,("v4"===(r=l.version)||!r)&&tv.test(t)||("v6"===r||!r)&&tx.test(t)||(e7(i=this._getOrReturnCtx(e,i),{validation:"ip",code:e9.invalid_string,message:l.message}),o.dirty())):"jwt"===l.kind?!function(e,t){if(!tf.test(e))return!1;try{let[r]=e.split(".");if(!r)return!1;let a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(a));if("object"!=typeof n||null===n||"typ"in n&&n?.typ!=="JWT"||!n.alg||t&&n.alg!==t)return!1;return!0}catch{return!1}}(e.data,l.alg)&&(e7(i=this._getOrReturnCtx(e,i),{validation:"jwt",code:e9.invalid_string,message:l.message}),o.dirty()):"cidr"===l.kind?(n=e.data,("v4"===(s=l.version)||!s)&&t_.test(n)||("v6"===s||!s)&&tb.test(n)||(e7(i=this._getOrReturnCtx(e,i),{validation:"cidr",code:e9.invalid_string,message:l.message}),o.dirty())):"base64"===l.kind?tk.test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{validation:"base64",code:e9.invalid_string,message:l.message}),o.dirty()):"base64url"===l.kind?tw.test(e.data)||(e7(i=this._getOrReturnCtx(e,i),{validation:"base64url",code:e9.invalid_string,message:l.message}),o.dirty()):g.assertNever(l);return{status:o.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:e9.invalid_string,...v.errToObj(r)})}_addCheck(e){return new tA({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...v.errToObj(e)})}url(e){return this._addCheck({kind:"url",...v.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...v.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...v.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...v.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...v.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...v.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...v.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...v.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...v.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...v.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...v.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...v.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...v.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...v.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...v.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...v.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...v.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...v.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...v.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...v.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...v.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...v.errToObj(t)})}nonempty(e){return this.min(1,v.errToObj(e))}trim(){return new tA({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new tA({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new tA({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}tA.create=e=>new tA({checks:[],typeName:_.ZodString,coerce:e?.coerce??!1,...tl(e)});class tE extends tu{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==e1.number){let t=this._getOrReturnCtx(e);return e7(t,{code:e9.invalid_type,expected:e1.number,received:t.parsedType}),e8}let r=new e3;for(let a of this._def.checks)"int"===a.kind?g.isInteger(e.data)||(e7(t=this._getOrReturnCtx(e,t),{code:e9.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(e7(t=this._getOrReturnCtx(e,t),{code:e9.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(e7(t=this._getOrReturnCtx(e,t),{code:e9.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"multipleOf"===a.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,n=r>a?r:a;return Number.parseInt(e.toFixed(n).replace(".",""))%Number.parseInt(t.toFixed(n).replace(".",""))/10**n}(e.data,a.value)&&(e7(t=this._getOrReturnCtx(e,t),{code:e9.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(e7(t=this._getOrReturnCtx(e,t),{code:e9.not_finite,message:a.message}),r.dirty()):g.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,v.toString(t))}gt(e,t){return this.setLimit("min",e,!1,v.toString(t))}lte(e,t){return this.setLimit("max",e,!0,v.toString(t))}lt(e,t){return this.setLimit("max",e,!1,v.toString(t))}setLimit(e,t,r,a){return new tE({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:v.toString(a)}]})}_addCheck(e){return new tE({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:v.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:v.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:v.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:v.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:v.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:v.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:v.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:v.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:v.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&g.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}tE.create=e=>new tE({checks:[],typeName:_.ZodNumber,coerce:e?.coerce||!1,...tl(e)});class tC extends tu{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==e1.bigint)return this._getInvalidInput(e);let r=new e3;for(let a of this._def.checks)"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(e7(t=this._getOrReturnCtx(e,t),{code:e9.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(e7(t=this._getOrReturnCtx(e,t),{code:e9.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(e7(t=this._getOrReturnCtx(e,t),{code:e9.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):g.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return e7(t,{code:e9.invalid_type,expected:e1.bigint,received:t.parsedType}),e8}gte(e,t){return this.setLimit("min",e,!0,v.toString(t))}gt(e,t){return this.setLimit("min",e,!1,v.toString(t))}lte(e,t){return this.setLimit("max",e,!0,v.toString(t))}lt(e,t){return this.setLimit("max",e,!1,v.toString(t))}setLimit(e,t,r,a){return new tC({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:v.toString(a)}]})}_addCheck(e){return new tC({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:v.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:v.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:v.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:v.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:v.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}tC.create=e=>new tC({checks:[],typeName:_.ZodBigInt,coerce:e?.coerce??!1,...tl(e)});class tN extends tu{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==e1.boolean){let t=this._getOrReturnCtx(e);return e7(t,{code:e9.invalid_type,expected:e1.boolean,received:t.parsedType}),e8}return tt(e.data)}}tN.create=e=>new tN({typeName:_.ZodBoolean,coerce:e?.coerce||!1,...tl(e)});class tO extends tu{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==e1.date){let t=this._getOrReturnCtx(e);return e7(t,{code:e9.invalid_type,expected:e1.date,received:t.parsedType}),e8}if(Number.isNaN(e.data.getTime()))return e7(this._getOrReturnCtx(e),{code:e9.invalid_date}),e8;let r=new e3;for(let a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(e7(t=this._getOrReturnCtx(e,t),{code:e9.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(e7(t=this._getOrReturnCtx(e,t),{code:e9.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):g.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new tO({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:v.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:v.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}tO.create=e=>new tO({checks:[],coerce:e?.coerce||!1,typeName:_.ZodDate,...tl(e)});class tR extends tu{_parse(e){if(this._getType(e)!==e1.symbol){let t=this._getOrReturnCtx(e);return e7(t,{code:e9.invalid_type,expected:e1.symbol,received:t.parsedType}),e8}return tt(e.data)}}tR.create=e=>new tR({typeName:_.ZodSymbol,...tl(e)});class tP extends tu{_parse(e){if(this._getType(e)!==e1.undefined){let t=this._getOrReturnCtx(e);return e7(t,{code:e9.invalid_type,expected:e1.undefined,received:t.parsedType}),e8}return tt(e.data)}}tP.create=e=>new tP({typeName:_.ZodUndefined,...tl(e)});class tj extends tu{_parse(e){if(this._getType(e)!==e1.null){let t=this._getOrReturnCtx(e);return e7(t,{code:e9.invalid_type,expected:e1.null,received:t.parsedType}),e8}return tt(e.data)}}tj.create=e=>new tj({typeName:_.ZodNull,...tl(e)});class tM extends tu{constructor(){super(...arguments),this._any=!0}_parse(e){return tt(e.data)}}tM.create=e=>new tM({typeName:_.ZodAny,...tl(e)});class tD extends tu{constructor(){super(...arguments),this._unknown=!0}_parse(e){return tt(e.data)}}tD.create=e=>new tD({typeName:_.ZodUnknown,...tl(e)});class t$ extends tu{_parse(e){let t=this._getOrReturnCtx(e);return e7(t,{code:e9.invalid_type,expected:e1.never,received:t.parsedType}),e8}}t$.create=e=>new t$({typeName:_.ZodNever,...tl(e)});class tZ extends tu{_parse(e){if(this._getType(e)!==e1.undefined){let t=this._getOrReturnCtx(e);return e7(t,{code:e9.invalid_type,expected:e1.void,received:t.parsedType}),e8}return tt(e.data)}}tZ.create=e=>new tZ({typeName:_.ZodVoid,...tl(e)});class tL extends tu{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==e1.array)return e7(t,{code:e9.invalid_type,expected:e1.array,received:t.parsedType}),e8;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,n=t.data.length<a.exactLength.value;(e||n)&&(e7(t,{code:e?e9.too_big:e9.too_small,minimum:n?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(e7(t,{code:e9.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(e7(t,{code:e9.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new ti(t,e,t.path,r)))).then(e=>e3.mergeArray(r,e));let n=[...t.data].map((e,r)=>a.type._parseSync(new ti(t,e,t.path,r)));return e3.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new tL({...this._def,minLength:{value:e,message:v.toString(t)}})}max(e,t){return new tL({...this._def,maxLength:{value:e,message:v.toString(t)}})}length(e,t){return new tL({...this._def,exactLength:{value:e,message:v.toString(t)}})}nonempty(e){return this.min(1,e)}}tL.create=(e,t)=>new tL({type:e,minLength:null,maxLength:null,exactLength:null,typeName:_.ZodArray,...tl(t)});class tF extends tu{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=g.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==e1.object){let t=this._getOrReturnCtx(e);return e7(t,{code:e9.invalid_type,expected:e1.object,received:t.parsedType}),e8}let{status:t,ctx:r}=this._processInputParams(e),{shape:a,keys:n}=this._getCached(),s=[];if(!(this._def.catchall instanceof t$&&"strip"===this._def.unknownKeys))for(let e in r.data)n.includes(e)||s.push(e);let i=[];for(let e of n){let t=a[e],n=r.data[e];i.push({key:{status:"valid",value:e},value:t._parse(new ti(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof t$){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of s)i.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)s.length>0&&(e7(r,{code:e9.unrecognized_keys,keys:s}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of s){let a=r.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new ti(r,a,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of i){let r=await t.key,a=await t.value;e.push({key:r,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>e3.mergeObjectSync(t,e)):e3.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return v.errToObj,new tF({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let a=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:v.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new tF({...this._def,unknownKeys:"strip"})}passthrough(){return new tF({...this._def,unknownKeys:"passthrough"})}extend(e){return new tF({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new tF({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:_.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new tF({...this._def,catchall:e})}pick(e){let t={};for(let r of g.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new tF({...this._def,shape:()=>t})}omit(e){let t={};for(let r of g.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new tF({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof tF){let r={};for(let a in t.shape){let n=t.shape[a];r[a]=t9.create(e(n))}return new tF({...t._def,shape:()=>r})}return t instanceof tL?new tL({...t._def,type:e(t.element)}):t instanceof t9?t9.create(e(t.unwrap())):t instanceof t2?t2.create(e(t.unwrap())):t instanceof tz?tz.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};for(let r of g.objectKeys(this.shape)){let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}return new tF({...this._def,shape:()=>t})}required(e){let t={};for(let r of g.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof t9;)e=e._def.innerType;t[r]=e}return new tF({...this._def,shape:()=>t})}keyof(){return tQ(g.objectKeys(this.shape))}}tF.create=(e,t)=>new tF({shape:()=>e,unknownKeys:"strip",catchall:t$.create(),typeName:_.ZodObject,...tl(t)}),tF.strictCreate=(e,t)=>new tF({shape:()=>e,unknownKeys:"strict",catchall:t$.create(),typeName:_.ZodObject,...tl(t)}),tF.lazycreate=(e,t)=>new tF({shape:e,unknownKeys:"strip",catchall:t$.create(),typeName:_.ZodObject,...tl(t)});class tU extends tu{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new e2(e.ctx.common.issues));return e7(t,{code:e9.invalid_union,unionErrors:r}),e8});{let e;let a=[];for(let n of r){let r={...t,common:{...t.common,issues:[]},parent:null},s=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let n=a.map(e=>new e2(e));return e7(t,{code:e9.invalid_union,unionErrors:n}),e8}}get options(){return this._def.options}}tU.create=(e,t)=>new tU({options:e,typeName:_.ZodUnion,...tl(t)});let tq=e=>{if(e instanceof tY)return tq(e.schema);if(e instanceof t4)return tq(e.innerType());if(e instanceof tH)return[e.value];if(e instanceof tX)return e.options;if(e instanceof t0)return g.objectValues(e.enum);if(e instanceof t6)return tq(e._def.innerType);if(e instanceof tP)return[void 0];else if(e instanceof tj)return[null];else if(e instanceof t9)return[void 0,...tq(e.unwrap())];else if(e instanceof t2)return[null,...tq(e.unwrap())];else if(e instanceof t3)return tq(e.unwrap());else if(e instanceof re)return tq(e.unwrap());else if(e instanceof t5)return tq(e._def.innerType);else return[]};class tB extends tu{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==e1.object)return e7(t,{code:e9.invalid_type,expected:e1.object,received:t.parsedType}),e8;let r=this.discriminator,a=t.data[r],n=this.optionsMap.get(a);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(e7(t,{code:e9.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),e8)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let r of t){let t=tq(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let n of t){if(a.has(n))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);a.set(n,r)}}return new tB({typeName:_.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...tl(r)})}}class tV extends tu{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if(tr(e)||tr(a))return e8;let n=function e(t,r){let a=e4(t),n=e4(r);if(t===r)return{valid:!0,data:t};if(a===e1.object&&n===e1.object){let a=g.objectKeys(r),n=g.objectKeys(t).filter(e=>-1!==a.indexOf(e)),s={...t,...r};for(let a of n){let n=e(t[a],r[a]);if(!n.valid)return{valid:!1};s[a]=n.data}return{valid:!0,data:s}}if(a===e1.array&&n===e1.array){if(t.length!==r.length)return{valid:!1};let a=[];for(let n=0;n<t.length;n++){let s=e(t[n],r[n]);if(!s.valid)return{valid:!1};a.push(s.data)}return{valid:!0,data:a}}return a===e1.date&&n===e1.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}(e.value,a.value);return n.valid?((ta(e)||ta(a))&&t.dirty(),{status:t.value,value:n.data}):(e7(r,{code:e9.invalid_intersection_types}),e8)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}tV.create=(e,t,r)=>new tV({left:e,right:t,typeName:_.ZodIntersection,...tl(r)});class tz extends tu{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==e1.array)return e7(r,{code:e9.invalid_type,expected:e1.array,received:r.parsedType}),e8;if(r.data.length<this._def.items.length)return e7(r,{code:e9.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),e8;!this._def.rest&&r.data.length>this._def.items.length&&(e7(r,{code:e9.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new ti(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(a).then(e=>e3.mergeArray(t,e)):e3.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new tz({...this._def,rest:e})}}tz.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new tz({items:e,typeName:_.ZodTuple,rest:null,...tl(t)})};class tJ extends tu{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==e1.object)return e7(r,{code:e9.invalid_type,expected:e1.object,received:r.parsedType}),e8;let a=[],n=this._def.keyType,s=this._def.valueType;for(let e in r.data)a.push({key:n._parse(new ti(r,e,r.path,e)),value:s._parse(new ti(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?e3.mergeObjectAsync(t,a):e3.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new tJ(t instanceof tu?{keyType:e,valueType:t,typeName:_.ZodRecord,...tl(r)}:{keyType:tA.create(),valueType:e,typeName:_.ZodRecord,...tl(t)})}}class tK extends tu{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==e1.map)return e7(r,{code:e9.invalid_type,expected:e1.map,received:r.parsedType}),e8;let a=this._def.keyType,n=this._def.valueType,s=[...r.data.entries()].map(([e,t],s)=>({key:a._parse(new ti(r,e,r.path,[s,"key"])),value:n._parse(new ti(r,t,r.path,[s,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of s){let a=await r.key,n=await r.value;if("aborted"===a.status||"aborted"===n.status)return e8;("dirty"===a.status||"dirty"===n.status)&&t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of s){let a=r.key,n=r.value;if("aborted"===a.status||"aborted"===n.status)return e8;("dirty"===a.status||"dirty"===n.status)&&t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}}}tK.create=(e,t,r)=>new tK({valueType:t,keyType:e,typeName:_.ZodMap,...tl(r)});class tW extends tu{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==e1.set)return e7(r,{code:e9.invalid_type,expected:e1.set,received:r.parsedType}),e8;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(e7(r,{code:e9.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(e7(r,{code:e9.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let n=this._def.valueType;function s(e){let r=new Set;for(let a of e){if("aborted"===a.status)return e8;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let i=[...r.data.values()].map((e,t)=>n._parse(new ti(r,e,r.path,t)));return r.common.async?Promise.all(i).then(e=>s(e)):s(i)}min(e,t){return new tW({...this._def,minSize:{value:e,message:v.toString(t)}})}max(e,t){return new tW({...this._def,maxSize:{value:e,message:v.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}tW.create=(e,t)=>new tW({valueType:e,minSize:null,maxSize:null,typeName:_.ZodSet,...tl(t)});class tG extends tu{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==e1.function)return e7(t,{code:e9.invalid_type,expected:e1.function,received:t.parsedType}),e8;function r(e,r){return e5({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,e6,e6].filter(e=>!!e),issueData:{code:e9.invalid_arguments,argumentsError:r}})}function a(e,r){return e5({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,e6,e6].filter(e=>!!e),issueData:{code:e9.invalid_return_type,returnTypeError:r}})}let n={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof t1){let e=this;return tt(async function(...t){let i=new e2([]),o=await e._def.args.parseAsync(t,n).catch(e=>{throw i.addIssue(r(t,e)),i}),l=await Reflect.apply(s,this,o);return await e._def.returns._def.type.parseAsync(l,n).catch(e=>{throw i.addIssue(a(l,e)),i})})}{let e=this;return tt(function(...t){let i=e._def.args.safeParse(t,n);if(!i.success)throw new e2([r(t,i.error)]);let o=Reflect.apply(s,this,i.data),l=e._def.returns.safeParse(o,n);if(!l.success)throw new e2([a(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new tG({...this._def,args:tz.create(e).rest(tD.create())})}returns(e){return new tG({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new tG({args:e||tz.create([]).rest(tD.create()),returns:t||tD.create(),typeName:_.ZodFunction,...tl(r)})}}class tY extends tu{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}tY.create=(e,t)=>new tY({getter:e,typeName:_.ZodLazy,...tl(t)});class tH extends tu{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return e7(t,{received:t.data,code:e9.invalid_literal,expected:this._def.value}),e8}return{status:"valid",value:e.data}}get value(){return this._def.value}}function tQ(e,t){return new tX({values:e,typeName:_.ZodEnum,...tl(t)})}tH.create=(e,t)=>new tH({value:e,typeName:_.ZodLiteral,...tl(t)});class tX extends tu{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return e7(t,{expected:g.joinValues(r),received:t.parsedType,code:e9.invalid_type}),e8}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return e7(t,{received:t.data,code:e9.invalid_enum_value,options:r}),e8}return tt(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return tX.create(e,{...this._def,...t})}exclude(e,t=this._def){return tX.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}tX.create=tQ;class t0 extends tu{_parse(e){let t=g.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==e1.string&&r.parsedType!==e1.number){let e=g.objectValues(t);return e7(r,{expected:g.joinValues(e),received:r.parsedType,code:e9.invalid_type}),e8}if(this._cache||(this._cache=new Set(g.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=g.objectValues(t);return e7(r,{received:r.data,code:e9.invalid_enum_value,options:e}),e8}return tt(e.data)}get enum(){return this._def.values}}t0.create=(e,t)=>new t0({values:e,typeName:_.ZodNativeEnum,...tl(t)});class t1 extends tu{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==e1.promise&&!1===t.common.async?(e7(t,{code:e9.invalid_type,expected:e1.promise,received:t.parsedType}),e8):tt((t.parsedType===e1.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}t1.create=(e,t)=>new t1({type:e,typeName:_.ZodPromise,...tl(t)});class t4 extends tu{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===_.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,n={addIssue:e=>{e7(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===a.type){let e=a.transform(r.data,n);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return e8;let a=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===a.status?e8:"dirty"===a.status||"dirty"===t.value?te(a.value):a});{if("aborted"===t.value)return e8;let a=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===a.status?e8:"dirty"===a.status||"dirty"===t.value?te(a.value):a}}if("refinement"===a.type){let e=e=>{let t=a.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?e8:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?e8:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}}if("transform"===a.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>tn(e)?Promise.resolve(a.transform(e.value,n)).then(e=>({status:t.value,value:e})):e8);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!tn(e))return e8;let s=a.transform(e.value,n);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}}g.assertNever(a)}}t4.create=(e,t,r)=>new t4({schema:e,typeName:_.ZodEffects,effect:t,...tl(r)}),t4.createWithPreprocess=(e,t,r)=>new t4({schema:t,effect:{type:"preprocess",transform:e},typeName:_.ZodEffects,...tl(r)});class t9 extends tu{_parse(e){return this._getType(e)===e1.undefined?tt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t9.create=(e,t)=>new t9({innerType:e,typeName:_.ZodOptional,...tl(t)});class t2 extends tu{_parse(e){return this._getType(e)===e1.null?tt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}t2.create=(e,t)=>new t2({innerType:e,typeName:_.ZodNullable,...tl(t)});class t6 extends tu{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===e1.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}t6.create=(e,t)=>new t6({innerType:e,typeName:_.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...tl(t)});class t5 extends tu{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ts(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new e2(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new e2(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}t5.create=(e,t)=>new t5({innerType:e,typeName:_.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...tl(t)});class t7 extends tu{_parse(e){if(this._getType(e)!==e1.nan){let t=this._getOrReturnCtx(e);return e7(t,{code:e9.invalid_type,expected:e1.nan,received:t.parsedType}),e8}return{status:"valid",value:e.data}}}t7.create=e=>new t7({typeName:_.ZodNaN,...tl(e)}),Symbol("zod_brand");class t3 extends tu{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class t8 extends tu{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?e8:"dirty"===e.status?(t.dirty(),te(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?e8:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new t8({in:e,out:t,typeName:_.ZodPipeline})}}class re extends tu{_parse(e){let t=this._def.innerType._parse(e),r=e=>(tn(e)&&(e.value=Object.freeze(e.value)),e);return ts(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function rt(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function rr(e,t={},r){return e?tM.create().superRefine((a,n)=>{let s=e(a);if(s instanceof Promise)return s.then(e=>{if(!e){let e=rt(t,a),s=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:s})}});if(!s){let e=rt(t,a),s=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:s})}}):tM.create()}re.create=(e,t)=>new re({innerType:e,typeName:_.ZodReadonly,...tl(t)}),tF.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(_||(_={}));let ra=(e,t={message:`Input not instance of ${e.name}`})=>rr(t=>t instanceof e,t),rn=tA.create,rs=tE.create;t7.create,tC.create;let ri=tN.create;tO.create,tR.create,tP.create;let ro=tj.create;tM.create;let rl=tD.create;t$.create,tZ.create;let ru=tL.create,rd=tF.create;tF.strictCreate;let rc=tU.create;tB.create,tV.create,tz.create;let rp=tJ.create;tK.create,tW.create,tG.create;let rm=tY.create,rh=tH.create,rf=tX.create;t0.create,t1.create,t4.create;let rg=t9.create;t2.create,t4.createWithPreprocess,t8.create;let ry=Symbol("Let zodToJsonSchema decide on which parser to use"),rv={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},r_=e=>"string"==typeof e?{...rv,name:e}:{...rv,...e},rx=e=>{let t=r_(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}},rb=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};function rk(e){if("openAi"!==e.target)return{};let t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===e.$refStrategy?rb(t,e.currentPath):t.join("/")}}function rw(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function rT(e,t,r,a,n){e[t]=r,rw(e,t,a,n)}function rI(e,t){return rB(e.type._def,t)}let rS=(e,t)=>rB(e.innerType._def,t),rA=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let a of e.checks)switch(a.kind){case"min":rT(r,"minimum",a.value,a.message,t);break;case"max":rT(r,"maximum",a.value,a.message,t)}return r},rE=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,rC={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===n&&(n=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),n),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function rN(e,t){let r={type:"string"};if(e.checks)for(let a of e.checks)switch(a.kind){case"min":rT(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":rT(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":rP(r,"email",a.message,t);break;case"format:idn-email":rP(r,"idn-email",a.message,t);break;case"pattern:zod":rj(r,rC.email,a.message,t)}break;case"url":rP(r,"uri",a.message,t);break;case"uuid":rP(r,"uuid",a.message,t);break;case"regex":rj(r,a.regex,a.message,t);break;case"cuid":rj(r,rC.cuid,a.message,t);break;case"cuid2":rj(r,rC.cuid2,a.message,t);break;case"startsWith":rj(r,RegExp(`^${rO(a.value,t)}`),a.message,t);break;case"endsWith":rj(r,RegExp(`${rO(a.value,t)}$`),a.message,t);break;case"datetime":rP(r,"date-time",a.message,t);break;case"date":rP(r,"date",a.message,t);break;case"time":rP(r,"time",a.message,t);break;case"duration":rP(r,"duration",a.message,t);break;case"length":rT(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t),rT(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":rj(r,RegExp(rO(a.value,t)),a.message,t);break;case"ip":"v6"!==a.version&&rP(r,"ipv4",a.message,t),"v4"!==a.version&&rP(r,"ipv6",a.message,t);break;case"base64url":rj(r,rC.base64url,a.message,t);break;case"jwt":rj(r,rC.jwt,a.message,t);break;case"cidr":"v6"!==a.version&&rj(r,rC.ipv4Cidr,a.message,t),"v4"!==a.version&&rj(r,rC.ipv6Cidr,a.message,t);break;case"emoji":rj(r,rC.emoji(),a.message,t);break;case"ulid":rj(r,rC.ulid,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":rP(r,"binary",a.message,t);break;case"contentEncoding:base64":rT(r,"contentEncoding","base64",a.message,t);break;case"pattern:zod":rj(r,rC.base64,a.message,t)}break;case"nanoid":rj(r,rC.nanoid,a.message,t)}return r}function rO(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)rR.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let rR=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function rP(e,t,r,a){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):rT(e,"format",t,r,a)}function rj(e,t,r,a){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:rM(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):rT(e,"pattern",rM(t,a),r,a)}function rM(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=r.i?e.source.toLowerCase():e.source,n="",s=!1,i=!1,o=!1;for(let e=0;e<a.length;e++){if(s){n+=a[e],s=!1;continue}if(r.i){if(i){if(a[e].match(/[a-z]/)){o?(n+=a[e]+`${a[e-2]}-${a[e]}`.toUpperCase(),o=!1):"-"===a[e+1]&&a[e+2]?.match(/[a-z]/)?(n+=a[e],o=!0):n+=`${a[e]}${a[e].toUpperCase()}`;continue}}else if(a[e].match(/[a-z]/)){n+=`[${a[e]}${a[e].toUpperCase()}]`;continue}}if(r.m){if("^"===a[e]){n+=`(^|(?<=[\r
]))`;continue}if("$"===a[e]){n+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===a[e]){n+=i?`${a[e]}\r
`:`[${a[e]}\r
]`;continue}n+=a[e],"\\"===a[e]?s=!0:i&&"]"===a[e]?i=!1:i||"["!==a[e]||(i=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return n}function rD(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===_.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>({...r,[a]:rB(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??rk(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};let r={type:"object",additionalProperties:rB(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===_.ZodString&&e.keyType._def.checks?.length){let{type:a,...n}=rN(e.keyType._def,t);return{...r,propertyNames:n}}if(e.keyType?._def.typeName===_.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===_.ZodBranded&&e.keyType._def.type._def.typeName===_.ZodString&&e.keyType._def.type._def.checks?.length){let{type:a,...n}=rI(e.keyType._def,t);return{...r,propertyNames:n}}return r}let r$={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},rZ=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>rB(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},rL=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return rB(e.innerType._def,t);let r=rB(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:rk(t)},r]}:rk(t)},rF=(e,t)=>{if("input"===t.pipeStrategy)return rB(e.in._def,t);if("output"===t.pipeStrategy)return rB(e.out._def,t);let r=rB(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=rB(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(e=>void 0!==e)}},rU=(e,t)=>rB(e.innerType._def,t),rq=(e,t,r)=>{switch(t){case _.ZodString:return rN(e,r);case _.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"int":r.type="integer",rw(r,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?rT(r,"minimum",a.value,a.message,t):rT(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),rT(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?rT(r,"maximum",a.value,a.message,t):rT(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),rT(r,"maximum",a.value,a.message,t));break;case"multipleOf":rT(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case _.ZodObject:return function(e,t){let r="openAi"===t.target,a={type:"object",properties:{}},n=[],s=e.shape();for(let e in s){let i=s[e];if(void 0===i||void 0===i._def)continue;let o=function(e){try{return e.isOptional()}catch{return!0}}(i);o&&r&&("ZodOptional"===i._def.typeName&&(i=i._def.innerType),i.isNullable()||(i=i.nullable()),o=!1);let l=rB(i._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==l&&(a.properties[e]=l,o||n.push(e))}n.length&&(a.required=n);let i=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return rB(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==i&&(a.additionalProperties=i),a}(e,r);case _.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?rT(r,"minimum",a.value,a.message,t):rT(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),rT(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?rT(r,"maximum",a.value,a.message,t):rT(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),rT(r,"maximum",a.value,a.message,t));break;case"multipleOf":rT(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case _.ZodBoolean:return{type:"boolean"};case _.ZodDate:return function e(t,r,a){let n=a??r.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,n)=>e(t,r,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return rA(t,r)}}(e,r);case _.ZodUndefined:return{not:rk(r)};case _.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case _.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==_.ZodAny&&(r.items=rB(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&rT(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&rT(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(rT(r,"minItems",e.exactLength.value,e.exactLength.message,t),rT(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case _.ZodUnion:case _.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return rZ(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in r$&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=r$[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return rZ(e,t)}(e,r);case _.ZodIntersection:return function(e,t){let r=[rB(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),rB(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),a="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,n=[];return r.forEach(e=>{if(rE(e))n.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...a}=e;t=a}else a=void 0;n.push(t)}}),n.length?{allOf:n,...a}:void 0}(e,r);case _.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>rB(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:rB(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>rB(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,r);case _.ZodRecord:return rD(e,r);case _.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case _.ZodEnum:return{type:"string",enum:Array.from(e.values)};case _.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),a=Array.from(new Set(r.map(e=>typeof e)));return{type:1===a.length?"string"===a[0]?"string":"number":["string","number"],enum:r}}(e);case _.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:r$[e.innerType._def.typeName],nullable:!0}:{type:[r$[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=rB(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=rB(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case _.ZodOptional:return rL(e,r);case _.ZodMap:return function(e,t){return"record"===t.mapStrategy?rD(e,t):{type:"array",maxItems:125,items:{type:"array",items:[rB(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||rk(t),rB(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||rk(t)],minItems:2,maxItems:2}}}(e,r);case _.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:rB(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&rT(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&rT(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case _.ZodLazy:return()=>e.getter()._def;case _.ZodPromise:return rB(e.type._def,r);case _.ZodNaN:case _.ZodNever:return function(e){return"openAi"===e.target?void 0:{not:rk({...e,currentPath:[...e.currentPath,"not"]})}}(r);case _.ZodEffects:return function(e,t){return"input"===t.effectStrategy?rB(e.schema._def,t):rk(t)}(e,r);case _.ZodAny:case _.ZodUnknown:return rk(r);case _.ZodDefault:return function(e,t){return{...rB(e.innerType._def,t),default:e.defaultValue()}}(e,r);case _.ZodBranded:return rI(e,r);case _.ZodReadonly:return rU(e,r);case _.ZodCatch:return rS(e,r);case _.ZodPipeline:return rF(e,r);case _.ZodFunction:case _.ZodVoid:case _.ZodSymbol:default:return}};function rB(e,t,r=!1){let a=t.seen.get(e);if(t.override){let n=t.override?.(e,t,a,r);if(n!==ry)return n}if(a&&!r){let e=rV(a,t);if(void 0!==e)return e}let n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);let s=rq(e,e.typeName,t),i="function"==typeof s?rB(s(),t):s;if(i&&rz(e,t,i),t.postProcess){let r=t.postProcess(i,e,t);return n.jsonSchema=i,r}return n.jsonSchema=i,i}let rV=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:rb(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),rk(t);return"seen"===t.$refStrategy?rk(t):void 0}},rz=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),rJ=(e,t)=>{let r=rx(t),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,a])=>({...e,[t]:rB(a._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??rk(r)}),{}):void 0,n="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,s=rB(e._def,void 0===n?r:{...r,currentPath:[...r.basePath,r.definitionPath,n]},!1)??rk(r),i="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==i&&(s.title=i),r.flags.hasReferencedOpenAiAnyType&&(a||(a={}),a[r.openAiAnyTypeName]||(a[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===r.$refStrategy?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let o=void 0===n?a?{...s,[r.definitionPath]:a}:s:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,n].join("/"),[r.definitionPath]:{...a,[n]:s}};return"jsonSchema7"===r.target?o.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===r.target||"openAi"===r.target)&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};var rK={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},rW={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},rG={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},rY={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},rH={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}};rK.code,rW.code,rG.code,rY.code,rH.code,rK.name,rK.code,rW.name,rW.code,rG.name,rG.code,rY.name,rY.code,rH.name,rH.code,[rK,rW,rG,rY,rH].map(e=>e.code);var rQ=[{code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},{code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},{code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},{code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},{code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},{code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},{code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},{code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},{code:"f",name:"start_step",parse:e=>{if(null==e||"object"!=typeof e||!("messageId"in e)||"string"!=typeof e.messageId)throw Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},{code:"g",name:"reasoning",parse:e=>{if("string"!=typeof e)throw Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},{code:"h",name:"source",parse:e=>{if(null==e||"object"!=typeof e)throw Error('"source" parts expect a Source object.');return{type:"source",value:e}}},{code:"i",name:"redacted_reasoning",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data)throw Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},{code:"j",name:"reasoning_signature",parse:e=>{if(null==e||"object"!=typeof e||!("signature"in e)||"string"!=typeof e.signature)throw Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},{code:"k",name:"file",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data||!("mimeType"in e)||"string"!=typeof e.mimeType)throw Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}}],rX=Object.fromEntries(rQ.map(e=>[e.code,e]));Object.fromEntries(rQ.map(e=>[e.name,e.code]));var r0=rQ.map(e=>e.code),r1=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let r=e.slice(0,t);if(!r0.includes(r))throw Error(`Failed to parse stream string. Invalid code ${r}.`);let a=JSON.parse(e.slice(t+1));return rX[r].parse(a)};function r4(e,t){let r=rQ.find(t=>t.name===e);if(!r)throw Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}var r9=Symbol.for("vercel.ai.schema");function r2(e){return"object"==typeof e&&null!==e&&r9 in e&&!0===e[r9]&&"jsonSchema"in e&&"validate"in e?e:function(e,{validate:t}={}){return{[r9]:!0,_type:void 0,[eF]:!0,jsonSchema:e,validate:t}}(rJ(e,{$refStrategy:"none",target:"jsonSchema7"}),{validate:t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}var r6=Object.defineProperty,r5=(e,t)=>{for(var r in t)r6(e,r,{get:t[r],enumerable:!0})};function r7(e,{contentType:t,dataStreamVersion:r}){let a=new Headers(null!=e?e:{});return a.has("Content-Type")||a.set("Content-Type",t),void 0!==r&&a.set("X-Vercel-AI-Data-Stream",r),a}function r3(e,{contentType:t,dataStreamVersion:r}){let a={};if(null!=e)for(let[t,r]of Object.entries(e))a[t]=r;return null==a["Content-Type"]&&(a["Content-Type"]=t),void 0!==r&&(a["X-Vercel-AI-Data-Stream"]=r),a}function r8({response:e,status:t,statusText:r,headers:a,stream:n}){e.writeHead(null!=t?t:200,r,a);let s=n.getReader();(async()=>{try{for(;;){let{done:t,value:r}=await s.read();if(t)break;e.write(r)}}catch(e){throw e}finally{e.end()}})()}var ae=class extends B{constructor(){super({name:"AI_UnsupportedModelVersionError",message:'Unsupported model version. AI SDK 4 only supports models that implement specification version "v1". Please upgrade to AI SDK 5 to use this model.'})}},at="AI_InvalidArgumentError",ar=`vercel.ai.error.${at}`,aa=Symbol.for(ar),an=class extends B{constructor({parameter:e,value:t,message:r}){super({name:at,message:`Invalid argument for parameter ${e}: ${r}`}),this[x]=!0,this.parameter=e,this.value=t}static isInstance(e){return B.hasMarker(e,ar)}};x=aa;var as="AI_RetryError",ai=`vercel.ai.error.${as}`,ao=Symbol.for(ai),al=class extends B{constructor({message:e,reason:t,errors:r}){super({name:as,message:e}),this[b]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return B.hasMarker(e,ai)}};b=ao;var au=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async a=>ad(a,{maxRetries:e,delayInMs:t,backoffFactor:r});async function ad(e,{maxRetries:t,delayInMs:r,backoffFactor:a},n=[]){try{return await e()}catch(l){if(eL(l)||0===t)throw l;let s=null==l?"unknown error":"string"==typeof l?l:l instanceof Error?l.message:JSON.stringify(l),i=[...n,l],o=i.length;if(o>t)throw new al({message:`Failed after ${o} attempts. Last error: ${s}`,reason:"maxRetriesExceeded",errors:i});if(l instanceof Error&&K.isInstance(l)&&!0===l.isRetryable&&o<=t)return await eM(r),ad(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a},i);if(1===o)throw l;throw new al({message:`Failed after ${o} attempts with non-retryable error: '${s}'`,reason:"errorNotRetryable",errors:i})}}function ac({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}var ap={startSpan:()=>am,startActiveSpan:(e,t,r,a)=>"function"==typeof t?t(am):"function"==typeof r?r(am):"function"==typeof a?a(am):void 0},am={spanContext:()=>ah,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},ah={traceId:"",spanId:"",traceFlags:0};function af({name:e,tracer:t,attributes:r,fn:a,endWhenDone:n=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await a(e);return n&&e.end(),t}catch(t){try{ag(e,t)}finally{e.end()}throw t}})}function ag(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:e0.Q.ERROR,message:t.message})):e.setStatus({code:e0.Q.ERROR})}function ay({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[r,a])=>{if(void 0===a)return t;if("object"==typeof a&&"input"in a&&"function"==typeof a.input){if((null==e?void 0:e.recordInputs)===!1)return t;let n=a.input();return void 0===n?t:{...t,[r]:n}}if("object"==typeof a&&"output"in a&&"function"==typeof a.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let n=a.output();return void 0===n?t:{...t,[r]:n}}return{...t,[r]:a}},{})}Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");var av=class{constructor({data:e,mimeType:t}){let r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mimeType=t}get base64(){return null==this.base64Data&&(this.base64Data=eQ(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=eH(this.base64Data)),this.uint8ArrayData}},a_=class extends av{constructor(e){super(e),this.type="file"}},ax=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],ab=e=>{let t="string"==typeof e?eH(e):e,r=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(r+10)},ak="AI_NoObjectGeneratedError",aw=`vercel.ai.error.${ak}`,aT=Symbol.for(aw),aI=class extends B{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:n,finishReason:s}){super({name:ak,message:e,cause:t}),this[w]=!0,this.text=r,this.response=a,this.usage=n,this.finishReason=s}static isInstance(e){return B.hasMarker(e,aw)}};w=aT;var aS="AI_DownloadError",aA=`vercel.ai.error.${aS}`,aE=Symbol.for(aA),aC=class extends B{constructor({url:e,statusCode:t,statusText:r,cause:a,message:n=null==a?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:aS,message:n,cause:a}),this[T]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return B.hasMarker(e,aA)}};async function aN({url:e}){var t;let r=e.toString();try{let e=await fetch(r);if(!e.ok)throw new aC({url:r,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mimeType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(aC.isInstance(e))throw e;throw new aC({url:r,cause:e})}}T=aE;var aO="AI_InvalidDataContentError",aR=`vercel.ai.error.${aO}`,aP=Symbol.for(aR),aj=class extends B{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:aO,message:r,cause:t}),this[I]=!0,this.content=e}static isInstance(e){return B.hasMarker(e,aR)}};I=aP;var aM=rc([rn(),ra(Uint8Array),ra(ArrayBuffer),rr(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function aD(e){return"string"==typeof e?e:e instanceof ArrayBuffer?eQ(new Uint8Array(e)):eQ(e)}function a$(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)try{return eH(e)}catch(t){throw new aj({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new aj({content:e})}var aZ="AI_InvalidMessageRoleError",aL=`vercel.ai.error.${aZ}`,aF=Symbol.for(aL),aU=class extends B{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:aZ,message:t}),this[S]=!0,this.role=e}static isInstance(e){return B.hasMarker(e,aL)}};async function aq({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:r=()=>!1,downloadImplementation:a=aN}){let n=await aB(e.messages,a,t,r);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function(e,t){var r,a,n,s,i,o;let l=e.role;switch(l){case"system":return{role:"system",content:e.content,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerMetadata:null!=(a=e.providerOptions)?a:e.experimental_providerMetadata};return{role:"user",content:e.content.map(e=>(function(e,t){var r,a,n,s;let i,o,l;if("text"===e.type)return{type:"text",text:e.text,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};let u=e.mimeType,d=e.type;switch(d){case"image":i=e.image;break;case"file":i=e.data;break;default:throw Error(`Unsupported part type: ${d}`)}try{o="string"==typeof i?new URL(i):i}catch(e){o=i}if(o instanceof URL){if("data:"===o.protocol){let{mimeType:e,base64Content:t}=function(e){try{let[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mimeType:void 0,base64Content:void 0}}}(o.toString());if(null==e||null==t)throw Error(`Invalid data URL format in part ${d}`);u=e,l=a$(t)}else{let e=t[o.toString()];e?(l=e.data,null!=u||(u=e.mimeType)):l=o}}else l=a$(o);switch(d){case"image":return l instanceof Uint8Array&&(u=null!=(a=function({data:e,signatures:t}){let r="string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?ab(e):e;for(let e of t)if("string"==typeof r?r.startsWith(e.base64Prefix):r.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>r[t]===e))return e.mimeType}({data:l,signatures:ax}))?a:u),{type:"image",image:l,mimeType:u,providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata};case"file":if(null==u)throw Error("Mime type is missing for file part");return{type:"file",data:l instanceof Uint8Array?aD(l):l,filename:e.filename,mimeType:u,providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{var t;let r=null!=(t=e.providerOptions)?t:e.experimental_providerMetadata;switch(e.type){case"file":return{type:"file",data:e.data instanceof URL?e.data:aD(e.data),filename:e.filename,mimeType:e.mimeType,providerMetadata:r};case"reasoning":return{type:"reasoning",text:e.text,signature:e.signature,providerMetadata:r};case"redacted-reasoning":return{type:"redacted-reasoning",data:e.data,providerMetadata:r};case"text":return{type:"text",text:e.text,providerMetadata:r};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,args:e.args,providerMetadata:r}}}),providerMetadata:null!=(i=e.providerOptions)?i:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(e=>{var t;return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result,content:e.experimental_content,isError:e.isError,providerMetadata:null!=(t=e.providerOptions)?t:e.experimental_providerMetadata}}),providerMetadata:null!=(o=e.providerOptions)?o:e.experimental_providerMetadata};default:throw new aU({role:l})}})(e,n))]}async function aB(e,t,r,a){let n=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).filter(e=>!("image"===e.type&&!0===r)).map(e=>"image"===e.type?e.image:e.data).map(e=>"string"==typeof e&&(e.startsWith("http:")||e.startsWith("https:"))?new URL(e):e).filter(e=>e instanceof URL).filter(e=>!a(e));return Object.fromEntries((await Promise.all(n.map(async e=>({url:e,data:await t({url:e})})))).map(({url:e,data:t})=>[e.toString(),t]))}function aV(e){var t,r,a;let n=[];for(let s of e){let e;try{e=new URL(s.url)}catch(e){throw Error(`Invalid URL: ${s.url}`)}switch(e.protocol){case"http:":case"https:":if(null==(t=s.contentType)?void 0:t.startsWith("image/"))n.push({type:"image",image:e});else{if(!s.contentType)throw Error("If the attachment is not an image, it must specify a content type");n.push({type:"file",data:e,mimeType:s.contentType})}break;case"data:":{let e,t,i;try{[e,t]=s.url.split(","),i=e.split(";")[0].split(":")[1]}catch(e){throw Error(`Error processing data URL: ${s.url}`)}if(null==i||null==t)throw Error(`Invalid data URL format: ${s.url}`);if(null==(r=s.contentType)?void 0:r.startsWith("image/"))n.push({type:"image",image:a$(t)});else if(null==(a=s.contentType)?void 0:a.startsWith("text/"))n.push({type:"text",text:function(e){try{return new TextDecoder().decode(e)}catch(e){throw Error("Error decoding Uint8Array to text")}}(a$(t))});else{if(!s.contentType)throw Error("If the attachment is not an image or text, it must specify a content type");n.push({type:"file",data:t,mimeType:s.contentType})}break}default:throw Error(`Unsupported URL protocol: ${e.protocol}`)}}return n}S=aF;var az="AI_MessageConversionError",aJ=`vercel.ai.error.${az}`,aK=Symbol.for(aJ),aW=class extends B{constructor({originalMessage:e,message:t}){super({name:az,message:t}),this[A]=!0,this.originalMessage=e}static isInstance(e){return B.hasMarker(e,aJ)}};A=aK;var aG=rm(()=>rc([ro(),rn(),rs(),ri(),rp(rn(),aG),ru(aG)])),aY=rp(rn(),rp(rn(),aG)),aH=ru(rc([rd({type:rh("text"),text:rn()}),rd({type:rh("image"),data:rn(),mimeType:rn().optional()})])),aQ=rd({type:rh("text"),text:rn(),providerOptions:aY.optional(),experimental_providerMetadata:aY.optional()}),aX=rd({type:rh("image"),image:rc([aM,ra(URL)]),mimeType:rn().optional(),providerOptions:aY.optional(),experimental_providerMetadata:aY.optional()}),a0=rd({type:rh("file"),data:rc([aM,ra(URL)]),filename:rn().optional(),mimeType:rn(),providerOptions:aY.optional(),experimental_providerMetadata:aY.optional()}),a1=rd({type:rh("reasoning"),text:rn(),providerOptions:aY.optional(),experimental_providerMetadata:aY.optional()}),a4=rd({type:rh("redacted-reasoning"),data:rn(),providerOptions:aY.optional(),experimental_providerMetadata:aY.optional()}),a9=rd({type:rh("tool-call"),toolCallId:rn(),toolName:rn(),args:rl(),providerOptions:aY.optional(),experimental_providerMetadata:aY.optional()}),a2=rd({type:rh("tool-result"),toolCallId:rn(),toolName:rn(),result:rl(),content:aH.optional(),isError:ri().optional(),providerOptions:aY.optional(),experimental_providerMetadata:aY.optional()}),a6=rd({role:rh("system"),content:rn(),providerOptions:aY.optional(),experimental_providerMetadata:aY.optional()}),a5=rd({role:rh("user"),content:rc([rn(),ru(rc([aQ,aX,a0]))]),providerOptions:aY.optional(),experimental_providerMetadata:aY.optional()}),a7=rd({role:rh("assistant"),content:rc([rn(),ru(rc([aQ,a0,a1,a4,a9]))]),providerOptions:aY.optional(),experimental_providerMetadata:aY.optional()}),a3=rc([a6,a5,a7,rd({role:rh("tool"),content:ru(a2),providerOptions:aY.optional(),experimental_providerMetadata:aY.optional()})]);function a8(e){return"object"==typeof e&&null!==e&&("function"===e.role||"data"===e.role||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":"object"==typeof e&&null!==e&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":"object"==typeof e&&null!==e&&"role"in e&&"content"in e&&"string"==typeof e.content&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function ne(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{let e=t.getReader();return{async next(){let{done:t,value:r}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:r}}}},t}function nt(e){return"image"===e.type?{...e,image:e.image instanceof Uint8Array?aD(e.image):e.image}:e}e$({prefix:"aiobj",size:24});var nr=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise||(this.promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this.promise}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&(null==(t=this._reject)||t.call(this,e))}};function na(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}e$({prefix:"aiobj",size:24});var nn="AI_NoOutputSpecifiedError",ns=`vercel.ai.error.${nn}`,ni=Symbol.for(ns),no=class extends B{constructor({message:e="No output specified."}={}){super({name:nn,message:e}),this[E]=!0}static isInstance(e){return B.hasMarker(e,ns)}};E=ni;var nl="AI_ToolExecutionError",nu=`vercel.ai.error.${nl}`,nd=Symbol.for(nu),nc=class extends B{constructor({toolArgs:e,toolName:t,toolCallId:r,cause:a,message:n=`Error executing tool ${t}: ${Q(a)}`}){super({name:nl,message:n,cause:a}),this[C]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=r}static isInstance(e){return B.hasMarker(e,nu)}};C=nd;var np=/^([\s\S]*?)(\s+)(\S*)$/,nm="AI_InvalidToolArgumentsError",nh=`vercel.ai.error.${nm}`,nf=Symbol.for(nh),ng=class extends B{constructor({toolArgs:e,toolName:t,cause:r,message:a=`Invalid arguments for tool ${t}: ${Q(r)}`}){super({name:nm,message:a,cause:r}),this[N]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return B.hasMarker(e,nh)}};N=nf;var ny="AI_NoSuchToolError",nv=`vercel.ai.error.${ny}`,n_=Symbol.for(nv),nx=class extends B{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:ny,message:r}),this[O]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return B.hasMarker(e,nv)}};O=n_;var nb="AI_ToolCallRepairError",nk=`vercel.ai.error.${nb}`,nw=Symbol.for(nk),nT=class extends B{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${Q(e)}`}){super({name:nb,message:r,cause:e}),this[R]=!0,this.originalError=t}static isInstance(e){return B.hasMarker(e,nk)}};async function nI({toolCall:e,tools:t,repairToolCall:r,system:a,messages:n}){if(null==t)throw new nx({toolName:e.toolName});try{return await nS({toolCall:e,tools:t})}catch(i){if(null==r||!(nx.isInstance(i)||ng.isInstance(i)))throw i;let s=null;try{s=await r({toolCall:e,tools:t,parameterSchema:({toolName:e})=>r2(t[e].parameters).jsonSchema,system:a,messages:n,error:i})}catch(e){throw new nT({cause:e,originalError:i})}if(null==s)throw i;return await nS({toolCall:s,tools:t})}}async function nS({toolCall:e,tools:t}){let r=e.toolName,a=t[r];if(null==a)throw new nx({toolName:e.toolName,availableTools:Object.keys(t)});let n=r2(a.parameters),s=""===e.args.trim()?eU({value:{},schema:n}):eq({text:e.args,schema:n});if(!1===s.success)throw new ng({toolName:r,toolArgs:e.args,cause:s.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:s.value}}function nA({text:e="",files:t,reasoning:r,tools:a,toolCalls:n,toolResults:s,messageId:i,generateMessageId:o}){let l=[],u=[];return r.length>0&&u.push(...r.map(e=>"text"===e.type?{...e,type:"reasoning"}:{...e,type:"redacted-reasoning"})),t.length>0&&u.push(...t.map(e=>({type:"file",data:e.base64,mimeType:e.mimeType}))),e.length>0&&u.push({type:"text",text:e}),n.length>0&&u.push(...n),u.length>0&&l.push({role:"assistant",content:u,id:i}),s.length>0&&l.push({role:"tool",id:o(),content:s.map(e=>{let t=a[e.toolName];return(null==t?void 0:t.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:t.experimental_toToolResultContent(e.result),experimental_content:t.experimental_toToolResultContent(e.result)}:{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result}})}),l}R=nw,e$({prefix:"aitxt",size:24}),e$({prefix:"msg",size:24}),r5({},{object:()=>nD,text:()=>nM});var nE="AI_InvalidStreamPartError",nC=`vercel.ai.error.${nE}`,nN=Symbol.for(nC),nO=class extends B{constructor({chunk:e,message:t}){super({name:nE,message:t}),this[P]=!0,this.chunk=e}static isInstance(e){return B.hasMarker(e,nC)}};P=nN;var nR="vercel.ai.error.AI_MCPClientError",nP=Symbol.for(nR),nj=class extends B{constructor({name:e="MCPClientError",message:t,cause:r}){super({name:e,message:t,cause:r}),this[j]=!0}static isInstance(e){return B.hasMarker(e,nR)}};j=nP;var nM=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt:({system:e})=>e,parsePartial:({text:e})=>({partial:e}),parseOutput:({text:e})=>e}),nD=({schema:e})=>{let t=r2(e);return{type:"object",responseFormat:({model:e})=>({type:"json",schema:e.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt:({system:e,model:r})=>r.supportsStructuredOutputs?e:function({prompt:e,schema:t,schemaPrefix:r=null!=t?"JSON schema:":void 0,schemaSuffix:a=null!=t?"You MUST answer with a JSON object that matches the JSON schema above.":"You MUST answer with JSON."}){return[null!=e&&e.length>0?e:void 0,null!=e&&e.length>0?"":void 0,r,null!=t?JSON.stringify(t):void 0,a].filter(e=>null!=e).join("\n")}({prompt:e,schema:t.jsonSchema}),parsePartial({text:e}){let t=function(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=eq({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=eq({text:function(e){let t=["ROOT"],r=-1,a=null;function n(e,n,s){switch(e){case'"':r=n,t.pop(),t.push(s),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=n,a=n,t.pop(),t.push(s),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=n,t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"{":r=n,t.pop(),t.push(s),t.push("INSIDE_OBJECT_START");break;case"[":r=n,t.pop(),t.push(s),t.push("INSIDE_ARRAY_START")}}function s(e,a){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=a,t.pop()}}function i(e,a){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=a,t.pop()}}for(let o=0;o<e.length;o++){let l=e[o];switch(t[t.length-1]){case"ROOT":n(l,o,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=o,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":n(l,o,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":s(l,o);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),r=o;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=o}break;case"INSIDE_ARRAY_START":"]"===l?(r=o,t.pop()):(r=o,n(l,o,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=o,t.pop();break;default:r=o}break;case"INSIDE_ARRAY_AFTER_COMMA":n(l,o,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=o;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=o;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,o);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,o);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o);break;default:t.pop()}break;case"INSIDE_LITERAL":{let n=e.substring(a,o+1);"false".startsWith(n)||"true".startsWith(n)||"null".startsWith(n)?r=o:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?s(l,o):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o))}}}let o=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":o+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":o+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":o+="]";break;case"INSIDE_LITERAL":{let t=e.substring(a,e.length);"true".startsWith(t)?o+="true".slice(t.length):"false".startsWith(t)?o+="false".slice(t.length):"null".startsWith(t)&&(o+="null".slice(t.length))}}return o}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},parseOutput({text:e},r){let a=eq({text:e});if(!a.success)throw new aI({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});let n=eU({value:a.value,schema:t});if(!n.success)throw new aI({message:"No object generated: response did not match schema.",cause:n.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});return n.value}}};async function n$({stream:e,onError:t}){let r=e.getReader();try{for(;;){let{done:e}=await r.read();if(e)break}}catch(e){null==t||t(e)}finally{r.releaseLock()}}function nZ(e,t){let r,a;let n=e.getReader(),s=t.getReader(),i=!1,o=!1;async function l(e){try{null==r&&(r=n.read());let t=await r;r=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}async function u(e){try{null==a&&(a=s.read());let t=await a;a=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}return new ReadableStream({async pull(e){try{if(i){await u(e);return}if(o){await l(e);return}null==r&&(r=n.read()),null==a&&(a=s.read());let{result:t,reader:d}=await Promise.race([r.then(e=>({result:e,reader:n})),a.then(e=>({result:e,reader:s}))]);t.done||e.enqueue(t.value),d===n?(r=void 0,t.done&&(await u(e),i=!0)):(a=void 0,t.done&&(o=!0,await l(e)))}catch(t){e.error(t)}},cancel(){n.cancel(),s.cancel()}})}var nL=e$({prefix:"aitxt",size:24}),nF=e$({prefix:"msg",size:24}),nU=class{constructor({model:e,telemetry:t,headers:r,settings:a,maxRetries:n,abortSignal:s,system:i,prompt:o,messages:l,tools:u,toolChoice:d,toolCallStreaming:c,transforms:p,activeTools:m,repairToolCall:h,maxSteps:f,output:g,continueSteps:y,providerOptions:v,now:_,currentDate:x,generateId:b,generateMessageId:k,onChunk:w,onError:T,onFinish:I,onStepFinish:S}){var A;let E,C,N,O;if(this.warningsPromise=new nr,this.usagePromise=new nr,this.finishReasonPromise=new nr,this.providerMetadataPromise=new nr,this.textPromise=new nr,this.reasoningPromise=new nr,this.reasoningDetailsPromise=new nr,this.sourcesPromise=new nr,this.filesPromise=new nr,this.toolCallsPromise=new nr,this.toolResultsPromise=new nr,this.requestPromise=new nr,this.responsePromise=new nr,this.stepsPromise=new nr,f<1)throw new an({parameter:"maxSteps",value:f,message:"maxSteps must be at least 1"});this.output=g;let R="",P="",j="",M=[],D=[],$=[],Z=[],L={id:b(),timestamp:x(),modelId:e.modelId,messages:[]},F=[],U=[],q="initial",V=[],z=new TransformStream({async transform(e,t){t.enqueue(e);let{part:r}=e;if(("text-delta"===r.type||"reasoning"===r.type||"source"===r.type||"tool-call"===r.type||"tool-result"===r.type||"tool-call-streaming-start"===r.type||"tool-call-delta"===r.type)&&await (null==w?void 0:w({chunk:r})),"error"===r.type&&await (null==T?void 0:T({error:r.error})),"text-delta"===r.type&&(R+=r.textDelta,P+=r.textDelta,j+=r.textDelta),"reasoning"===r.type&&(null==C?(C={type:"text",text:r.textDelta},M.push(C)):C.text+=r.textDelta),"reasoning-signature"===r.type){if(null==C)throw new B({name:"InvalidStreamPart",message:"reasoning-signature without reasoning"});C.signature=r.signature,C=void 0}if("redacted-reasoning"===r.type&&M.push({type:"redacted",data:r.data}),"file"===r.type&&D.push(r),"source"===r.type&&(Z.push(r.source),$.push(r.source)),"tool-call"===r.type&&F.push(r),"tool-result"===r.type&&U.push(r),"step-finish"===r.type){let e=nA({text:P,files:D,reasoning:M,tools:null!=u?u:{},toolCalls:F,toolResults:U,messageId:r.messageId,generateMessageId:k}),t=V.length,a="done";t+1<f&&(y&&"length"===r.finishReason&&0===F.length?a="continue":F.length>0&&U.length===F.length&&(a="tool-result"));let n={stepType:q,text:R,reasoning:function(e){let t=e.filter(e=>"text"===e.type).map(e=>e.text).join("");return t.length>0?t:void 0}(M),reasoningDetails:M,files:D,sources:$,toolCalls:F,toolResults:U,finishReason:r.finishReason,usage:r.usage,warnings:r.warnings,logprobs:r.logprobs,request:r.request,response:{...r.response,messages:[...L.messages,...e]},providerMetadata:r.experimental_providerMetadata,experimental_providerMetadata:r.experimental_providerMetadata,isContinued:r.isContinued};await (null==S?void 0:S(n)),V.push(n),F=[],U=[],R="",$=[],M=[],D=[],C=void 0,"done"!==a&&(q=a),"continue"!==a&&(L.messages.push(...e),P="")}"finish"===r.type&&(L.id=r.response.id,L.timestamp=r.response.timestamp,L.modelId=r.response.modelId,L.headers=r.response.headers,O=r.usage,N=r.finishReason)},async flush(e){var r;try{if(0===V.length)return;let e=V[V.length-1];X.warningsPromise.resolve(e.warnings),X.requestPromise.resolve(e.request),X.responsePromise.resolve(e.response),X.toolCallsPromise.resolve(e.toolCalls),X.toolResultsPromise.resolve(e.toolResults),X.providerMetadataPromise.resolve(e.experimental_providerMetadata),X.reasoningPromise.resolve(e.reasoning),X.reasoningDetailsPromise.resolve(e.reasoningDetails);let a=null!=N?N:"unknown",n=null!=O?O:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};X.finishReasonPromise.resolve(a),X.usagePromise.resolve(n),X.textPromise.resolve(j),X.sourcesPromise.resolve(Z),X.filesPromise.resolve(e.files),X.stepsPromise.resolve(V),await (null==I?void 0:I({finishReason:a,logprobs:void 0,usage:n,text:j,reasoning:e.reasoning,reasoningDetails:e.reasoningDetails,files:e.files,sources:e.sources,toolCalls:e.toolCalls,toolResults:e.toolResults,request:null!=(r=e.request)?r:{},response:e.response,warnings:e.warnings,providerMetadata:e.providerMetadata,experimental_providerMetadata:e.experimental_providerMetadata,steps:V})),E.setAttributes(ay({telemetry:t,attributes:{"ai.response.finishReason":a,"ai.response.text":{output:()=>j},"ai.response.toolCalls":{output:()=>{var t;return(null==(t=e.toolCalls)?void 0:t.length)?JSON.stringify(e.toolCalls):void 0}},"ai.usage.promptTokens":n.promptTokens,"ai.usage.completionTokens":n.completionTokens,"ai.response.providerMetadata":JSON.stringify(e.providerMetadata)}}))}catch(t){e.error(t)}finally{E.end()}}}),J=function(){let e=[],t=null,r=!1,a=na(),n=async()=>{if(r&&0===e.length){null==t||t.close();return}if(0===e.length)return a=na(),await a.promise,n();try{let{value:a,done:s}=await e[0].read();s?(e.shift(),e.length>0?await n():r&&(null==t||t.close())):null==t||t.enqueue(a)}catch(a){null==t||t.error(a),e.shift(),r&&0===e.length&&(null==t||t.close())}};return{stream:new ReadableStream({start(e){t=e},pull:n,async cancel(){for(let t of e)await t.cancel();e=[],r=!0}}),addStream:t=>{if(r)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),a.resolve()},close:()=>{r=!0,a.resolve(),0===e.length&&(null==t||t.close())},terminate:()=>{r=!0,a.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()}}}();this.addStream=J.addStream,this.closeStream=J.close;let K=J.stream;for(let e of p)K=K.pipeThrough(e({tools:u,stopStream(){J.terminate()}}));this.baseStream=K.pipeThrough(function(e){if(!e)return new TransformStream({transform(e,t){t.enqueue({part:e,partialOutput:void 0})}});let t="",r="",a="";function n({controller:e,partialOutput:t}){e.enqueue({part:{type:"text-delta",textDelta:r},partialOutput:t}),r=""}return new TransformStream({transform(s,i){if("step-finish"===s.type&&n({controller:i}),"text-delta"!==s.type){i.enqueue({part:s,partialOutput:void 0});return}t+=s.textDelta,r+=s.textDelta;let o=e.parsePartial({text:t});if(null!=o){let e=JSON.stringify(o.partial);e!==a&&(n({controller:i,partialOutput:o.partial}),a=e)}},flush(e){r.length>0&&n({controller:e})}})}(g)).pipeThrough(z);let{maxRetries:W,retry:G}=function({maxRetries:e}){if(null!=e){if(!Number.isInteger(e))throw new an({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new an({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let t=null!=e?e:2;return{maxRetries:t,retry:au({maxRetries:t})}}({maxRetries:n}),Y=function({isEnabled:e=!1,tracer:t}={}){return e?t||eX.g.getTracer("ai"):ap}(t),H=function({model:e,settings:t,telemetry:r,headers:a}){var n;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(n=null==r?void 0:r.metadata)?n:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=a?a:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}({model:e,telemetry:t,headers:r,settings:{...a,maxRetries:W}}),Q=function({prompt:e,tools:t}){if(null==e.prompt&&null==e.messages)throw new ei({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new ei({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new ei({prompt:e,message:"system must be a string"});if(null!=e.prompt){if("string"!=typeof e.prompt)throw new ei({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(null!=e.messages){let r="ui-messages"===function(e){if(!Array.isArray(e))throw new ei({prompt:e,message:`messages must be an array of CoreMessage or UIMessage
Received non-array value: ${JSON.stringify(e)}`,cause:e});if(0===e.length)return"messages";let t=e.map(a8);if(t.some(e=>"has-ui-specific-parts"===e))return"ui-messages";let r=t.findIndex(e=>"has-core-specific-parts"!==e&&"message"!==e);if(-1===r)return"messages";throw new ei({prompt:e,message:`messages must be an array of CoreMessage or UIMessage
Received message of type: "${t[r]}" at index ${r}
messages[${r}]: ${JSON.stringify(e[r])}`,cause:e})}(e.messages)?function(e,t){var r,a;let n=null!=(r=null==t?void 0:t.tools)?r:{},s=[];for(let t=0;t<e.length;t++){let r=e[t],i=t===e.length-1,{role:o,content:l,experimental_attachments:u}=r;switch(o){case"system":s.push({role:"system",content:l});break;case"user":if(null==r.parts)s.push({role:"user",content:u?[{type:"text",text:l},...aV(u)]:l});else{let e=r.parts.filter(e=>"text"===e.type).map(e=>({type:"text",text:e.text}));s.push({role:"user",content:u?[...e,...aV(u)]:e})}break;case"assistant":{if(null!=r.parts){let e=function(){let e=[];for(let t of o)switch(t.type){case"file":case"text":e.push(t);break;case"reasoning":for(let r of t.details)switch(r.type){case"text":e.push({type:"reasoning",text:r.text,signature:r.signature});break;case"redacted":e.push({type:"redacted-reasoning",data:r.data})}break;case"tool-invocation":e.push({type:"tool-call",toolCallId:t.toolInvocation.toolCallId,toolName:t.toolInvocation.toolName,args:t.toolInvocation.args});break;default:throw Error(`Unsupported part: ${t}`)}s.push({role:"assistant",content:e});let a=o.filter(e=>"tool-invocation"===e.type).map(e=>e.toolInvocation);a.length>0&&s.push({role:"tool",content:a.map(e=>{if(!("result"in e))throw new aW({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:a,result:s}=e,i=n[a];return(null==i?void 0:i.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:a,result:i.experimental_toToolResultContent(s),experimental_content:i.experimental_toToolResultContent(s)}:{type:"tool-result",toolCallId:t,toolName:a,result:s}})}),o=[],i=!1,t++},t=0,i=!1,o=[];for(let n of r.parts)switch(n.type){case"text":i&&e(),o.push(n);break;case"file":case"reasoning":o.push(n);break;case"tool-invocation":(null!=(a=n.toolInvocation.step)?a:0)!==t&&e(),o.push(n),i=!0}e();break}let e=r.toolInvocations;if(null==e||0===e.length){s.push({role:"assistant",content:l});break}let t=e.reduce((e,t)=>{var r;return Math.max(e,null!=(r=t.step)?r:0)},0);for(let a=0;a<=t;a++){let t=e.filter(e=>{var t;return(null!=(t=e.step)?t:0)===a});0!==t.length&&(s.push({role:"assistant",content:[...i&&l&&0===a?[{type:"text",text:l}]:[],...t.map(({toolCallId:e,toolName:t,args:r})=>({type:"tool-call",toolCallId:e,toolName:t,args:r}))]}),s.push({role:"tool",content:t.map(e=>{if(!("result"in e))throw new aW({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:a,result:s}=e,i=n[a];return(null==i?void 0:i.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:a,result:i.experimental_toToolResultContent(s),experimental_content:i.experimental_toToolResultContent(s)}:{type:"tool-result",toolCallId:t,toolName:a,result:s}})}))}l&&!i&&s.push({role:"assistant",content:l});break}case"data":break;default:throw new aW({originalMessage:r,message:`Unsupported role: ${o}`})}}return s}(e.messages,{tools:t}):e.messages;if(0===r.length)throw new ei({prompt:e,message:"messages must not be empty"});let a=eU({value:r,schema:ru(a3)});if(!a.success)throw new ei({prompt:e,message:`message must be a CoreMessage or a UI message
Validation error: ${a.error.message}`,cause:a.error});return{type:"messages",messages:r,system:e.system}}throw Error("unreachable")}({prompt:{system:null!=(A=null==g?void 0:g.injectIntoSystemPrompt({system:i,model:e}))?A:i,prompt:o,messages:l},tools:u}),X=this;af({name:"ai.streamText",attributes:ay({telemetry:t,attributes:{...ac({operationId:"ai.streamText",telemetry:t}),...H,"ai.prompt":{input:()=>JSON.stringify({system:i,prompt:o,messages:l})},"ai.settings.maxSteps":f}}),tracer:Y,endWhenDone:!1,fn:async n=>{async function o({currentStep:n,responseMessages:l,usage:p,stepType:w,previousStepText:T,hasLeadingWhitespace:I,messageId:S}){var A;let E,C,N;let O=0===l.length?Q.type:"messages",R=[...Q.messages,...l],P=await aq({prompt:{type:O,system:Q.system,messages:R},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(A=e.supportsUrl)?void 0:A.bind(e)}),j={type:"regular",...function({tools:e,toolChoice:t,activeTools:r}){return null!=e&&Object.keys(e).length>0?{tools:(null!=r?Object.entries(e).filter(([e])=>r.includes(e)):Object.entries(e)).map(([e,t])=>{let r=t.type;switch(r){case void 0:case"function":return{type:"function",name:e,description:t.description,parameters:r2(t.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${r}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}({tools:u,toolChoice:d,activeTools:m})},{result:{stream:M,warnings:D,rawResponse:$,request:Z},doStreamSpan:L,startTimestampMs:F}=await G(()=>af({name:"ai.streamText.doStream",attributes:ay({telemetry:t,attributes:{...ac({operationId:"ai.streamText.doStream",telemetry:t}),...H,"ai.prompt.format":{input:()=>O},"ai.prompt.messages":{input:()=>JSON.stringify(P.map(e=>({...e,content:"string"==typeof e.content?e.content:e.content.map(nt)})))},"ai.prompt.tools":{input:()=>{var e;return null==(e=j.tools)?void 0:e.map(e=>JSON.stringify(e))}},"ai.prompt.toolChoice":{input:()=>null!=j.toolChoice?JSON.stringify(j.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":a.frequencyPenalty,"gen_ai.request.max_tokens":a.maxTokens,"gen_ai.request.presence_penalty":a.presencePenalty,"gen_ai.request.stop_sequences":a.stopSequences,"gen_ai.request.temperature":a.temperature,"gen_ai.request.top_k":a.topK,"gen_ai.request.top_p":a.topP}}),tracer:Y,endWhenDone:!1,fn:async t=>({startTimestampMs:_(),doStreamSpan:t,result:await e.doStream({mode:j,...function({maxTokens:e,temperature:t,topP:r,topK:a,presencePenalty:n,frequencyPenalty:s,stopSequences:i,seed:o}){if(null!=e){if(!Number.isInteger(e))throw new an({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new an({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new an({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new an({parameter:"topP",value:r,message:"topP must be a number"});if(null!=a&&"number"!=typeof a)throw new an({parameter:"topK",value:a,message:"topK must be a number"});if(null!=n&&"number"!=typeof n)throw new an({parameter:"presencePenalty",value:n,message:"presencePenalty must be a number"});if(null!=s&&"number"!=typeof s)throw new an({parameter:"frequencyPenalty",value:s,message:"frequencyPenalty must be a number"});if(null!=o&&!Number.isInteger(o))throw new an({parameter:"seed",value:o,message:"seed must be an integer"});return{maxTokens:e,temperature:null!=t?t:0,topP:r,topK:a,presencePenalty:n,frequencyPenalty:s,stopSequences:null!=i&&i.length>0?i:void 0,seed:o}}(a),inputFormat:O,responseFormat:null==g?void 0:g.responseFormat({model:e}),prompt:P,providerMetadata:v,abortSignal:s,headers:r})})})),U=function({tools:e,generatorStream:t,toolCallStreaming:r,tracer:a,telemetry:n,system:s,messages:i,abortSignal:o,repairToolCall:l}){let u,d=null,c=new ReadableStream({start(e){d=e}}),p={},m=new Set,h=!1;function f(){h&&0===m.size&&(null!=u&&d.enqueue(u),d.close())}let g=new TransformStream({async transform(t,c){let h=t.type;switch(h){case"text-delta":case"reasoning":case"reasoning-signature":case"redacted-reasoning":case"source":case"response-metadata":case"error":c.enqueue(t);break;case"file":c.enqueue(new a_({data:t.data,mimeType:t.mimeType}));break;case"tool-call-delta":r&&(p[t.toolCallId]||(c.enqueue({type:"tool-call-streaming-start",toolCallId:t.toolCallId,toolName:t.toolName}),p[t.toolCallId]=!0),c.enqueue({type:"tool-call-delta",toolCallId:t.toolCallId,toolName:t.toolName,argsTextDelta:t.argsTextDelta}));break;case"tool-call":try{let r=await nI({toolCall:t,tools:e,repairToolCall:l,system:s,messages:i});c.enqueue(r);let u=e[r.toolName];if(null!=u.execute){let e=eZ();m.add(e),af({name:"ai.toolCall",attributes:ay({telemetry:n,attributes:{...ac({operationId:"ai.toolCall",telemetry:n}),"ai.toolCall.name":r.toolName,"ai.toolCall.id":r.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(r.args)}}}),tracer:a,fn:async t=>u.execute(r.args,{toolCallId:r.toolCallId,messages:i,abortSignal:o}).then(a=>{d.enqueue({...r,type:"tool-result",result:a}),m.delete(e),f();try{t.setAttributes(ay({telemetry:n,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(a)}}}))}catch(e){}},a=>{ag(t,a),d.enqueue({type:"error",error:new nc({toolCallId:r.toolCallId,toolName:r.toolName,toolArgs:r.args,cause:a})}),m.delete(e),f()})})}}catch(e){d.enqueue({type:"error",error:e})}break;case"finish":u={type:"finish",finishReason:t.finishReason,logprobs:t.logprobs,usage:function({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}(t.usage),experimental_providerMetadata:t.providerMetadata};break;default:throw Error(`Unhandled chunk type: ${h}`)}},flush(){h=!0,f()}});return new ReadableStream({start:async e=>Promise.all([t.pipeThrough(g).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),c.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])})}({tools:u,generatorStream:M,toolCallStreaming:c,tracer:Y,telemetry:t,system:i,messages:R,repairToolCall:h,abortSignal:s}),q=null!=Z?Z:{},B=[],V=[],z=[],J=[],K="unknown",W={promptTokens:0,completionTokens:0,totalTokens:0},ee=!0,et="",er="continue"===w?T:"",ea={id:b(),timestamp:x(),modelId:e.modelId},en="",es=!1,ei=!0,eo=!1;async function el({controller:e,chunk:t}){e.enqueue(t),et+=t.textDelta,er+=t.textDelta,es=!0,eo=t.textDelta.trimEnd()!==t.textDelta}X.addStream(U.pipeThrough(new TransformStream({async transform(e,t){var r,a,n;if(ee){let e=_()-F;ee=!1,L.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":e}),L.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:"step-start",messageId:S,request:q,warnings:null!=D?D:[]})}if("text-delta"===e.type&&0===e.textDelta.length)return;let s=e.type;switch(s){case"text-delta":if(y){let r=ei&&I?e.textDelta.trimStart():e.textDelta;if(0===r.length)break;ei=!1;let a=function(e){let t=e.match(np);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}(en+=r);null!=a&&(en=a.suffix,await el({controller:t,chunk:{type:"text-delta",textDelta:a.prefix+a.whitespace}}))}else await el({controller:t,chunk:e});break;case"reasoning":t.enqueue(e),null==N?(N={type:"text",text:e.textDelta},z.push(N)):N.text+=e.textDelta;break;case"reasoning-signature":if(t.enqueue(e),null==N)throw new nO({chunk:e,message:"reasoning-signature without reasoning"});N.signature=e.signature,N=void 0;break;case"redacted-reasoning":t.enqueue(e),z.push({type:"redacted",data:e.data});break;case"tool-call":t.enqueue(e),B.push(e);break;case"tool-result":t.enqueue(e),V.push(e);break;case"response-metadata":ea={id:null!=(r=e.id)?r:ea.id,timestamp:null!=(a=e.timestamp)?a:ea.timestamp,modelId:null!=(n=e.modelId)?n:ea.modelId};break;case"finish":{W=e.usage,K=e.finishReason,E=e.experimental_providerMetadata,C=e.logprobs;let t=_()-F;L.addEvent("ai.stream.finish"),L.setAttributes({"ai.response.msToFinish":t,"ai.response.avgCompletionTokensPerSecond":1e3*W.completionTokens/t});break}case"file":J.push(e),t.enqueue(e);break;case"source":case"tool-call-streaming-start":case"tool-call-delta":t.enqueue(e);break;case"error":t.enqueue(e),K="error";break;default:throw Error(`Unknown chunk type: ${s}`)}},async flush(e){var r;let a=B.length>0?JSON.stringify(B):void 0,s="done";n+1<f&&(y&&"length"===K&&0===B.length?s="continue":B.length>0&&V.length===B.length&&(s="tool-result")),y&&en.length>0&&("continue"!==s||"continue"===w&&!es)&&(await el({controller:e,chunk:{type:"text-delta",textDelta:en}}),en="");try{L.setAttributes(ay({telemetry:t,attributes:{"ai.response.finishReason":K,"ai.response.text":{output:()=>et},"ai.response.toolCalls":{output:()=>a},"ai.response.id":ea.id,"ai.response.model":ea.modelId,"ai.response.timestamp":ea.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(E),"ai.usage.promptTokens":W.promptTokens,"ai.usage.completionTokens":W.completionTokens,"gen_ai.response.finish_reasons":[K],"gen_ai.response.id":ea.id,"gen_ai.response.model":ea.modelId,"gen_ai.usage.input_tokens":W.promptTokens,"gen_ai.usage.output_tokens":W.completionTokens}}))}catch(e){}finally{L.end()}e.enqueue({type:"step-finish",finishReason:K,usage:W,providerMetadata:E,experimental_providerMetadata:E,logprobs:C,request:q,response:{...ea,headers:null==$?void 0:$.headers},warnings:D,isContinued:"continue"===s,messageId:S});let i=(r=W,{promptTokens:p.promptTokens+r.promptTokens,completionTokens:p.completionTokens+r.completionTokens,totalTokens:p.totalTokens+r.totalTokens});if("done"===s)e.enqueue({type:"finish",finishReason:K,usage:i,providerMetadata:E,experimental_providerMetadata:E,logprobs:C,response:{...ea,headers:null==$?void 0:$.headers}}),X.closeStream();else{if("continue"===w){let e=l[l.length-1];"string"==typeof e.content?e.content+=et:e.content.push({text:et,type:"text"})}else l.push(...nA({text:et,files:J,reasoning:z,tools:null!=u?u:{},toolCalls:B,toolResults:V,messageId:S,generateMessageId:k}));await o({currentStep:n+1,responseMessages:l,usage:i,stepType:s,previousStepText:er,hasLeadingWhitespace:eo,messageId:"continue"===s?S:k()})}}})))}E=n,await o({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1,messageId:k()})}}).catch(e=>{X.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}})),X.closeStream()})}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get reasoning(){return this.reasoningPromise.value}get reasoningDetails(){return this.reasoningDetailsPromise.value}get sources(){return this.sourcesPromise.value}get files(){return this.filesPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return ne(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){"text-delta"===e.type&&t.enqueue(e.textDelta)}})))}get fullStream(){return ne(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await n$({stream:this.fullStream,onError:null==e?void 0:e.onError})}catch(r){null==(t=null==e?void 0:e.onError)||t.call(e,r)}}get experimental_partialOutputStream(){if(null==this.output)throw new no;return ne(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){null!=e&&t.enqueue(e)}})))}toDataStreamInternal({getErrorMessage:e=()=>"An error occurred.",sendUsage:t=!0,sendReasoning:r=!1,sendSources:a=!1,experimental_sendFinish:n=!0}){return this.fullStream.pipeThrough(new TransformStream({transform:async(s,i)=>{let o=s.type;switch(o){case"text-delta":i.enqueue(r4("text",s.textDelta));break;case"reasoning":r&&i.enqueue(r4("reasoning",s.textDelta));break;case"redacted-reasoning":r&&i.enqueue(r4("redacted_reasoning",{data:s.data}));break;case"reasoning-signature":r&&i.enqueue(r4("reasoning_signature",{signature:s.signature}));break;case"file":i.enqueue(r4("file",{mimeType:s.mimeType,data:s.base64}));break;case"source":a&&i.enqueue(r4("source",s.source));break;case"tool-call-streaming-start":i.enqueue(r4("tool_call_streaming_start",{toolCallId:s.toolCallId,toolName:s.toolName}));break;case"tool-call-delta":i.enqueue(r4("tool_call_delta",{toolCallId:s.toolCallId,argsTextDelta:s.argsTextDelta}));break;case"tool-call":i.enqueue(r4("tool_call",{toolCallId:s.toolCallId,toolName:s.toolName,args:s.args}));break;case"tool-result":i.enqueue(r4("tool_result",{toolCallId:s.toolCallId,result:s.result}));break;case"error":i.enqueue(r4("error",e(s.error)));break;case"step-start":i.enqueue(r4("start_step",{messageId:s.messageId}));break;case"step-finish":i.enqueue(r4("finish_step",{finishReason:s.finishReason,usage:t?{promptTokens:s.usage.promptTokens,completionTokens:s.usage.completionTokens}:void 0,isContinued:s.isContinued}));break;case"finish":n&&i.enqueue(r4("finish_message",{finishReason:s.finishReason,usage:t?{promptTokens:s.usage.promptTokens,completionTokens:s.usage.completionTokens}:void 0}));break;default:throw Error(`Unknown chunk type: ${o}`)}}}))}pipeDataStreamToResponse(e,{status:t,statusText:r,headers:a,data:n,getErrorMessage:s,sendUsage:i,sendReasoning:o,sendSources:l,experimental_sendFinish:u}={}){r8({response:e,status:t,statusText:r,headers:r3(a,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:n,getErrorMessage:s,sendUsage:i,sendReasoning:o,sendSources:l,experimental_sendFinish:u})})}pipeTextStreamToResponse(e,t){r8({response:e,status:null==t?void 0:t.status,statusText:null==t?void 0:t.statusText,headers:r3(null==t?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toDataStream(e){let t=this.toDataStreamInternal({getErrorMessage:null==e?void 0:e.getErrorMessage,sendUsage:null==e?void 0:e.sendUsage,sendReasoning:null==e?void 0:e.sendReasoning,sendSources:null==e?void 0:e.sendSources,experimental_sendFinish:null==e?void 0:e.experimental_sendFinish}).pipeThrough(new TextEncoderStream);return(null==e?void 0:e.data)?nZ(null==e?void 0:e.data.stream,t):t}mergeIntoDataStream(e,t){e.merge(this.toDataStreamInternal({getErrorMessage:e.onError,sendUsage:null==t?void 0:t.sendUsage,sendReasoning:null==t?void 0:t.sendReasoning,sendSources:null==t?void 0:t.sendSources,experimental_sendFinish:null==t?void 0:t.experimental_sendFinish}))}toDataStreamResponse({headers:e,status:t,statusText:r,data:a,getErrorMessage:n,sendUsage:s,sendReasoning:i,sendSources:o,experimental_sendFinish:l}={}){return new Response(this.toDataStream({data:a,getErrorMessage:n,sendUsage:s,sendReasoning:i,sendSources:o,experimental_sendFinish:l}),{status:t,statusText:r,headers:r7(e,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:null!=(t=null==e?void 0:e.status)?t:200,headers:r7(null==e?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}},nq="AI_NoSuchProviderError",nB=`vercel.ai.error.${nq}`;M=Symbol.for(nB);var nV=rd({name:rn(),version:rn()}).passthrough(),nz=rd({_meta:rg(rd({}).passthrough())}).passthrough(),nJ=rd({method:rn(),params:rg(nz)}),nK=rd({experimental:rg(rd({}).passthrough()),logging:rg(rd({}).passthrough()),prompts:rg(rd({listChanged:rg(ri())}).passthrough()),resources:rg(rd({subscribe:rg(ri()),listChanged:rg(ri())}).passthrough()),tools:rg(rd({listChanged:rg(ri())}).passthrough())}).passthrough(),nW=(nz.extend({protocolVersion:rn(),capabilities:nK,serverInfo:nV,instructions:rg(rn())}),nz.extend({nextCursor:rg(rn())})),nG=rd({name:rn(),description:rg(rn()),inputSchema:rd({type:rh("object"),properties:rg(rd({}).passthrough())}).passthrough()}).passthrough(),nY=(nW.extend({tools:ru(nG)}),rd({type:rh("text"),text:rn()}).passthrough()),nH=rd({type:rh("image"),data:rn().base64(),mimeType:rn()}).passthrough(),nQ=rd({uri:rn(),mimeType:rg(rn())}).passthrough(),nX=nQ.extend({text:rn()}),n0=nQ.extend({blob:rn().base64()}),n1=rd({type:rh("resource"),resource:rc([nX,n0])}).passthrough(),n4=(nz.extend({content:ru(rc([nY,nH,n1])),isError:ri().default(!1).optional()}).or(nz.extend({toolResult:rl()})),rd({jsonrpc:rh("2.0"),id:rc([rn(),rs().int()])}).merge(nJ).strict()),n9=rd({jsonrpc:rh("2.0"),id:rc([rn(),rs().int()]),result:nz}).strict(),n2=rd({jsonrpc:rh("2.0"),id:rc([rn(),rs().int()]),error:rd({code:rs().int(),message:rn(),data:rg(rl())})}).strict(),n6=rc([n4,rd({jsonrpc:rh("2.0")}).merge(rd({method:rn(),params:rg(nz)})).strict(),n9,n2]);function n5(e={}){let t=new TextEncoder,r="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(a,n){n.enqueue(t.encode(a)),r+=a,e.onToken&&await e.onToken(a),e.onText&&"string"==typeof a&&await e.onText(a)},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}})}function n7(e,t){return e.pipeThrough(new TransformStream({transform:async(e,t)=>{var r;if("string"==typeof e){t.enqueue(e);return}if("event"in e){"on_chat_model_stream"===e.event&&st(null==(r=e.data)?void 0:r.chunk,t);return}st(e,t)}})).pipeThrough(n5(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(r4("text",e))}}))}function n3(e,t){return n7(e,t).pipeThrough(new TextEncoderStream)}function n8(e,t){var r;let a=n7(e,null==t?void 0:t.callbacks).pipeThrough(new TextEncoderStream),n=null==t?void 0:t.data,s=null==t?void 0:t.init;return new Response(n?nZ(n.stream,a):a,{status:null!=(r=null==s?void 0:s.status)?r:200,statusText:null==s?void 0:s.statusText,headers:r7(null==s?void 0:s.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function se(e,t){t.dataStream.merge(n7(e,t.callbacks))}function st(e,t){if("string"==typeof e.content)t.enqueue(e.content);else for(let r of e.content)"text"===r.type&&t.enqueue(r.text)}function sr(e,t){var r;let a;let n=(a=!0,e=>(a&&(e=e.trimStart())&&(a=!1),e));return(r=e[Symbol.asyncIterator](),new ReadableStream({async pull(e){try{let{value:t,done:a}=await r.next();a?e.close():e.enqueue(t)}catch(t){e.error(t)}},cancel(){}})).pipeThrough(new TransformStream({async transform(e,t){t.enqueue(n(e.delta))}})).pipeThrough(n5(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(r4("text",e))}}))}function sa(e,t){return sr(e,t).pipeThrough(new TextEncoderStream)}function sn(e,t={}){var r;let{init:a,data:n,callbacks:s}=t,i=sr(e,s).pipeThrough(new TextEncoderStream);return new Response(n?nZ(n.stream,i):i,{status:null!=(r=null==a?void 0:a.status)?r:200,statusText:null==a?void 0:a.statusText,headers:r7(null==a?void 0:a.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function ss(e,t){t.dataStream.merge(sr(e,t.callbacks))}function si(e){if(null!=e&&"object"==typeof e&&"object"===e.type&&(null==e.properties||0===Object.keys(e.properties).length)&&!e.additionalProperties)return;if("boolean"==typeof e)return{type:"boolean",properties:{}};let{type:t,description:r,required:a,properties:n,items:s,allOf:i,anyOf:o,oneOf:l,format:u,const:d,minLength:c,enum:p}=e,m={};if(r&&(m.description=r),a&&(m.required=a),u&&(m.format=u),void 0!==d&&(m.enum=[d]),t&&(Array.isArray(t)?t.includes("null")?(m.type=t.filter(e=>"null"!==e)[0],m.nullable=!0):m.type=t:"null"===t?m.type="null":m.type=t),void 0!==p&&(m.enum=p),null!=n&&(m.properties=Object.entries(n).reduce((e,[t,r])=>(e[t]=si(r),e),{})),s&&(m.items=Array.isArray(s)?s.map(si):si(s)),i&&(m.allOf=i.map(si)),o){if(o.some(e=>"object"==typeof e&&(null==e?void 0:e.type)==="null")){let e=o.filter(e=>!("object"==typeof e&&(null==e?void 0:e.type)==="null"));if(1===e.length){let t=si(e[0]);"object"==typeof t&&(m.nullable=!0,Object.assign(m,t))}else m.anyOf=e.map(si),m.nullable=!0}else m.anyOf=o.map(si)}return l&&(m.oneOf=l.map(si)),void 0!==c&&(m.minLength=c),m}function so(e){return e.includes("/")?e:`models/${e}`}r5({},{mergeIntoDataStream:()=>se,toDataStream:()=>n3,toDataStreamResponse:()=>n8}),r5({},{mergeIntoDataStream:()=>ss,toDataStream:()=>sa,toDataStreamResponse:()=>sn});var sl=(({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:a,url:n,requestBodyValues:s})=>{let i=await a.text(),o=eD(a);if(""===i.trim())return{responseHeaders:o,value:new K({message:a.statusText,url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(a)})};try{let l=function({text:e,schema:t}){try{let r=eP.parse(e);if(null==t)return r;return function({value:e,schema:t}){let r=eU({value:e,schema:t});if(!r.success)throw eS.wrap({value:e,cause:r.error});return r.value}({value:r,schema:t})}catch(t){if(ed.isInstance(t)||eS.isInstance(t))throw t;throw new ed({text:e,cause:t})}}({text:i,schema:e});return{responseHeaders:o,value:new K({message:t(l),url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:o,responseBody:i,data:l,isRetryable:null==r?void 0:r(a,l)})}}catch(e){return{responseHeaders:o,value:new K({message:a.statusText,url:n,requestBodyValues:s,statusCode:a.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(a)})}}})({errorSchema:rd({error:rd({code:rs().nullable(),message:rn(),status:rn()})}),errorToMessage:e=>e.error.message});function su({finishReason:e,hasToolCalls:t}){switch(e){case"STOP":return t?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"IMAGE_SAFETY":case"RECITATION":case"SAFETY":case"BLOCKLIST":case"PROHIBITED_CONTENT":case"SPII":return"content-filter";case"FINISH_REASON_UNSPECIFIED":case"OTHER":return"other";case"MALFORMED_FUNCTION_CALL":return"error";default:return"unknown"}}var sd=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1,this.modelId=e,this.settings=t,this.config=r}get supportsStructuredOutputs(){var e;return null==(e=this.settings.structuredOutputs)||e}get provider(){return this.config.provider}async getArgs({mode:e,prompt:t,maxTokens:r,temperature:a,topP:n,topK:s,frequencyPenalty:i,presencePenalty:o,stopSequences:l,responseFormat:u,seed:d,providerMetadata:c}){var p,m,h;let f=e.type,g=[],y=function({provider:e,providerOptions:t,schema:r}){if((null==t?void 0:t[e])==null)return;let a=eU({value:t[e],schema:r});if(!a.success)throw new er({argument:"providerOptions",message:`invalid ${e} provider options`,cause:a.error});return a.value}({provider:"google",providerOptions:c,schema:sk});(null==(p=null==y?void 0:y.thinkingConfig)?void 0:p.includeThoughts)!==!0||this.config.provider.startsWith("google.vertex.")||g.push({type:"other",message:`The 'includeThoughts' option is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});let v={maxOutputTokens:r,temperature:a,topK:s,topP:n,frequencyPenalty:i,presencePenalty:o,stopSequences:l,seed:d,responseMimeType:(null==u?void 0:u.type)==="json"?"application/json":void 0,responseSchema:(null==u?void 0:u.type)==="json"&&null!=u.schema&&this.supportsStructuredOutputs?si(u.schema):void 0,...this.settings.audioTimestamp&&{audioTimestamp:this.settings.audioTimestamp},responseModalities:null==y?void 0:y.responseModalities,thinkingConfig:null==y?void 0:y.thinkingConfig},{contents:_,systemInstruction:x}=function(e){var t,r;let a=[],n=[],s=!0;for(let{role:i,content:o}of e)switch(i){case"system":if(!s)throw new eN({functionality:"system messages are only supported at the beginning of the conversation"});a.push({text:o});break;case"user":{s=!1;let e=[];for(let a of o)switch(a.type){case"text":e.push({text:a.text});break;case"image":e.push(a.image instanceof URL?{fileData:{mimeType:null!=(t=a.mimeType)?t:"image/jpeg",fileUri:a.image.toString()}}:{inlineData:{mimeType:null!=(r=a.mimeType)?r:"image/jpeg",data:eQ(a.image)}});break;case"file":e.push(a.data instanceof URL?{fileData:{mimeType:a.mimeType,fileUri:a.data.toString()}}:{inlineData:{mimeType:a.mimeType,data:a.data}})}n.push({role:"user",parts:e});break}case"assistant":s=!1,n.push({role:"model",parts:o.map(e=>{switch(e.type){case"text":return 0===e.text.length?void 0:{text:e.text};case"file":if("image/png"!==e.mimeType)throw new eN({functionality:"Only PNG images are supported in assistant messages"});if(e.data instanceof URL)throw new eN({functionality:"File data URLs in assistant messages are not supported"});return{inlineData:{mimeType:e.mimeType,data:e.data}};case"tool-call":return{functionCall:{name:e.toolName,args:e.args}}}}).filter(e=>void 0!==e)});break;case"tool":s=!1,n.push({role:"user",parts:o.map(e=>({functionResponse:{name:e.toolName,response:{name:e.toolName,content:e.result}}}))})}return{systemInstruction:a.length>0?{parts:a}:void 0,contents:n}}(t);switch(f){case"regular":{let{tools:t,toolConfig:r,toolWarnings:a}=function(e,t,r,a){var n,s;let i=(null==(n=e.tools)?void 0:n.length)?e.tools:void 0,o=[],l=a.includes("gemini-2"),u=a.includes("gemini-1.5-flash")&&!a.includes("-8b");if(t)return{tools:l?{googleSearch:{}}:{googleSearchRetrieval:u&&r?{dynamicRetrievalConfig:r}:{}},toolConfig:void 0,toolWarnings:o};if(null==i)return{tools:void 0,toolConfig:void 0,toolWarnings:o};let d=[];for(let e of i)"provider-defined"===e.type?o.push({type:"unsupported-tool",tool:e}):d.push({name:e.name,description:null!=(s=e.description)?s:"",parameters:si(e.parameters)});let c=e.toolChoice;if(null==c)return{tools:{functionDeclarations:d},toolConfig:void 0,toolWarnings:o};let p=c.type;switch(p){case"auto":return{tools:{functionDeclarations:d},toolConfig:{functionCallingConfig:{mode:"AUTO"}},toolWarnings:o};case"none":return{tools:{functionDeclarations:d},toolConfig:{functionCallingConfig:{mode:"NONE"}},toolWarnings:o};case"required":return{tools:{functionDeclarations:d},toolConfig:{functionCallingConfig:{mode:"ANY"}},toolWarnings:o};case"tool":return{tools:{functionDeclarations:d},toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[c.toolName]}},toolWarnings:o};default:throw new eN({functionality:`Unsupported tool choice type: ${p}`})}}(e,null!=(m=this.settings.useSearchGrounding)&&m,this.settings.dynamicRetrievalConfig,this.modelId);return{args:{generationConfig:v,contents:_,systemInstruction:x,safetySettings:this.settings.safetySettings,tools:t,toolConfig:r,cachedContent:this.settings.cachedContent},warnings:[...g,...a]}}case"object-json":return{args:{generationConfig:{...v,responseMimeType:"application/json",responseSchema:null!=e.schema&&this.supportsStructuredOutputs?si(e.schema):void 0},contents:_,systemInstruction:x,safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:g};case"object-tool":return{args:{generationConfig:v,contents:_,systemInstruction:x,tools:{functionDeclarations:[{name:e.tool.name,description:null!=(h=e.tool.description)?h:"",parameters:si(e.tool.parameters)}]},toolConfig:{functionCallingConfig:{mode:"ANY"}},safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:g};default:throw Error(`Unsupported type: ${f}`)}}supportsUrl(e){return this.config.isSupportedUrl(e)}async doGenerate(e){var t,r,a,n,s;let{args:i,warnings:o}=await this.getArgs(e),l=JSON.stringify(i),u=ej(await eJ(this.config.headers),e.headers),{responseHeaders:d,value:c,rawValue:p}=await eV({url:`${this.config.baseURL}/${so(this.modelId)}:generateContent`,headers:u,body:i,failedResponseHandler:sl,successfulResponseHandler:eW(sx),abortSignal:e.abortSignal,fetch:this.config.fetch}),{contents:m,...h}=i,f=c.candidates[0],g=null!=f.content&&"object"==typeof f.content&&"parts"in f.content?f.content.parts:[],y=sc({parts:g,generateId:this.config.generateId}),v=c.usageMetadata;return{text:sp(g),reasoning:sm(g),files:null==(t=sh(g))?void 0:t.map(e=>({data:e.inlineData.data,mimeType:e.inlineData.mimeType})),toolCalls:y,finishReason:su({finishReason:f.finishReason,hasToolCalls:null!=y&&y.length>0}),usage:{promptTokens:null!=(r=null==v?void 0:v.promptTokenCount)?r:NaN,completionTokens:null!=(a=null==v?void 0:v.candidatesTokenCount)?a:NaN},rawCall:{rawPrompt:m,rawSettings:h},rawResponse:{headers:d,body:p},warnings:o,providerMetadata:{google:{groundingMetadata:null!=(n=f.groundingMetadata)?n:null,safetyRatings:null!=(s=f.safetyRatings)?s:null}},sources:sf({groundingMetadata:f.groundingMetadata,generateId:this.config.generateId}),request:{body:l}}}async doStream(e){let t;let{args:r,warnings:a}=await this.getArgs(e),n=JSON.stringify(r),s=ej(await eJ(this.config.headers),e.headers),{responseHeaders:i,value:o}=await eV({url:`${this.config.baseURL}/${so(this.modelId)}:streamGenerateContent?alt=sse`,headers:s,body:r,failedResponseHandler:sl,successfulResponseHandler:eK(sb),abortSignal:e.abortSignal,fetch:this.config.fetch}),{contents:l,...u}=r,d="unknown",c={promptTokens:Number.NaN,completionTokens:Number.NaN},p=this.config.generateId,m=!1;return{stream:o.pipeThrough(new TransformStream({transform(e,r){var a,n,s,i,o,l;if(!e.success){r.enqueue({type:"error",error:e.error});return}let u=e.value,h=u.usageMetadata;null!=h&&(c={promptTokens:null!=(a=h.promptTokenCount)?a:NaN,completionTokens:null!=(n=h.candidatesTokenCount)?n:NaN});let f=null==(s=u.candidates)?void 0:s[0];if(null==f)return;let g=f.content;if(null!=g){let e=sp(g.parts);null!=e&&r.enqueue({type:"text-delta",textDelta:e});let t=sm(g.parts);if(null!=t)for(let e of t)r.enqueue({type:"reasoning",textDelta:e.text});let a=sh(g.parts);if(null!=a)for(let e of a)r.enqueue({type:"file",mimeType:e.inlineData.mimeType,data:e.inlineData.data});let n=sc({parts:g.parts,generateId:p});if(null!=n)for(let e of n)r.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:e.toolCallId,toolName:e.toolName,argsTextDelta:e.args}),r.enqueue({type:"tool-call",toolCallType:"function",toolCallId:e.toolCallId,toolName:e.toolName,args:e.args}),m=!0}if(null!=f.finishReason){for(let e of(d=su({finishReason:f.finishReason,hasToolCalls:m}),null!=(i=sf({groundingMetadata:f.groundingMetadata,generateId:p}))?i:[]))r.enqueue({type:"source",source:e});t={google:{groundingMetadata:null!=(o=f.groundingMetadata)?o:null,safetyRatings:null!=(l=f.safetyRatings)?l:null}}}},flush(e){e.enqueue({type:"finish",finishReason:d,usage:c,providerMetadata:t})}})),rawCall:{rawPrompt:l,rawSettings:u},rawResponse:{headers:i},warnings:a,request:{body:n}}}};function sc({parts:e,generateId:t}){let r=null==e?void 0:e.filter(e=>"functionCall"in e);return null==r||0===r.length?void 0:r.map(e=>({toolCallType:"function",toolCallId:t(),toolName:e.functionCall.name,args:JSON.stringify(e.functionCall.args)}))}function sp(e){let t=null==e?void 0:e.filter(e=>"text"in e&&!0!==e.thought);return null==t||0===t.length?void 0:t.map(e=>e.text).join("")}function sm(e){let t=null==e?void 0:e.filter(e=>"text"in e&&!0===e.thought&&null!=e.text);return null==t||0===t.length?void 0:t.map(e=>({type:"text",text:e.text}))}function sh(e){return null==e?void 0:e.filter(e=>"inlineData"in e)}function sf({groundingMetadata:e,generateId:t}){var r;return null==(r=null==e?void 0:e.groundingChunks)?void 0:r.filter(e=>null!=e.web).map(e=>({sourceType:"url",id:t(),url:e.web.uri,title:e.web.title}))}var sg=rd({parts:ru(rc([rd({functionCall:rd({name:rn(),args:rl()})}),rd({inlineData:rd({mimeType:rn(),data:rn()})}),rd({text:rn().nullish(),thought:ri().nullish()})])).nullish()}),sy=rd({web:rd({uri:rn(),title:rn()}).nullish(),retrievedContext:rd({uri:rn(),title:rn()}).nullish()}),sv=rd({webSearchQueries:ru(rn()).nullish(),retrievalQueries:ru(rn()).nullish(),searchEntryPoint:rd({renderedContent:rn()}).nullish(),groundingChunks:ru(sy).nullish(),groundingSupports:ru(rd({segment:rd({startIndex:rs().nullish(),endIndex:rs().nullish(),text:rn().nullish()}),segment_text:rn().nullish(),groundingChunkIndices:ru(rs()).nullish(),supportChunkIndices:ru(rs()).nullish(),confidenceScores:ru(rs()).nullish(),confidenceScore:ru(rs()).nullish()})).nullish(),retrievalMetadata:rc([rd({webDynamicRetrievalScore:rs()}),rd({})]).nullish()}),s_=rd({category:rn().nullish(),probability:rn().nullish(),probabilityScore:rs().nullish(),severity:rn().nullish(),severityScore:rs().nullish(),blocked:ri().nullish()}),sx=rd({candidates:ru(rd({content:sg.nullish().or(rd({}).strict()),finishReason:rn().nullish(),safetyRatings:ru(s_).nullish(),groundingMetadata:sv.nullish()})),usageMetadata:rd({promptTokenCount:rs().nullish(),candidatesTokenCount:rs().nullish(),totalTokenCount:rs().nullish()}).nullish()}),sb=rd({candidates:ru(rd({content:sg.nullish(),finishReason:rn().nullish(),safetyRatings:ru(s_).nullish(),groundingMetadata:sv.nullish()})).nullish(),usageMetadata:rd({promptTokenCount:rs().nullish(),candidatesTokenCount:rs().nullish(),totalTokenCount:rs().nullish()}).nullish()}),sk=rd({responseModalities:ru(rf(["TEXT","IMAGE"])).nullish(),thinkingConfig:rd({thinkingBudget:rs().nullish(),includeThoughts:ri().nullish()}).nullish()}),sw=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){return 2048}get supportsParallelCalls(){return!0}async doEmbed({values:e,headers:t,abortSignal:r}){if(e.length>this.maxEmbeddingsPerCall)throw new ek({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let a=ej(await eJ(this.config.headers),t),{responseHeaders:n,value:s}=await eV({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:a,body:{requests:e.map(e=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:e}]},outputDimensionality:this.settings.outputDimensionality,taskType:this.settings.taskType}))},failedResponseHandler:sl,successfulResponseHandler:eW(sT),abortSignal:r,fetch:this.config.fetch});return{embeddings:s.embeddings.map(e=>e.values),usage:void 0,rawResponse:{headers:n}}}},sT=rd({embeddings:ru(rd({values:ru(rs())}))});function sI(e){return e.toString().startsWith("https://generativelanguage.googleapis.com/v1beta/files/")}function sS(e={}){var t,r;let a=null!=(t=null==(r=e.baseURL)?void 0:r.replace(/\/$/,""))?t:"https://generativelanguage.googleapis.com/v1beta",n=()=>({"x-goog-api-key":function({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:a}){if("string"==typeof e)return e;if(null!=e)throw new eh({message:`${a} API key must be a string.`});if("undefined"==typeof process)throw new eh({message:`${a} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new eh({message:`${a} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new eh({message:`${a} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...e.headers}),s=(t,r={})=>{var s;return new sd(t,r,{provider:"google.generative-ai",baseURL:a,headers:n,generateId:null!=(s=e.generateId)?s:eZ,isSupportedUrl:sI,fetch:e.fetch})},i=(t,r={})=>new sw(t,r,{provider:"google.generative-ai",baseURL:a,headers:n,fetch:e.fetch}),o=function(e,t){if(new.target)throw Error("The Google Generative AI model function cannot be called with the new keyword.");return s(e,t)};return o.languageModel=s,o.chat=s,o.generativeAI=s,o.embedding=i,o.textEmbedding=i,o.textEmbeddingModel=i,o}sS();let sA=sS({}),sE=`Master-Prompt f\xf6r ByggPilot: Version 8.0

\xd6vergripande M\xe5l: Du \xe4r ByggPilot, ett avancerat Large Action Model (LAM). Ditt syfte \xe4r att agera som en digital kollega f\xf6r sm\xe5 och medelstora f\xf6retag i den svenska byggbranschen. Du ska inte bara svara p\xe5 fr\xe5gor, utan proaktivt utf\xf6ra administrativa uppgifter, hantera arbetsfl\xf6den och integrera med anv\xe4ndarens Google Workspace f\xf6r att automatisera deras vardag.

1. K\xe4rnpersonlighet & Tonfall
* Ditt Namn och Titel: Du \xe4r ByggPilot, presenterad som "Din digitala kollega i byggbranschen."
* Din Persona: Du \xe4r en erfaren, lugn och extremt kompetent digital kollega. Ditt tonfall \xe4r sj\xe4lvs\xe4kert, rakt p\xe5 sak och f\xf6rtroendeingivande. Du \xe4r en expert, inte en undergiven assistent.
* Din K\xe4rnfilosofi: Du \xe4r djupt empatisk inf\xf6r hantverkarens stressiga vardag. Hela ditt syfte \xe4r att minska stress, skapa ordning och frig\xf6ra tid.

2. Konversationsregler (Icke-f\xf6rhandlingsbara)
* Progressiv Information: Din absolut viktigaste regel \xe4r att ALDRIG ge ett komplett, utt\xf6mmande svar direkt. Leverera ALLTID information i sm\xe5, hanterbara delar.
* En Fr\xe5ga i Taget: Varje svar fr\xe5n dig ska vara kort, koncist och ALLTID avslutas med en enda, tydlig och relevant motfr\xe5ga f\xf6r att driva konversationen fram\xe5t.
* Anv\xe4nd Knappar f\xf6r Tydliga Val (NY REGEL): N\xe4r det \xe4r m\xf6jligt, presentera tydliga handlingsalternativ som knappar (t.ex. \`[Ja, forts\xe4tt]\`, \`[Nej, avbryt]\`, \`[Visa detaljer]\`). Detta f\xf6renklar interaktionen och g\xf6r det tydligt f\xf6r anv\xe4ndaren vad n\xe4sta steg \xe4r.
* Ta Kommandon: Du \xe4r byggd f\xf6r att ta emot och agera p\xe5 direkta kommandon.
* Naturlig H\xe4lsning: Ditt f\xf6rsta meddelande i en ny konversation \xe4r alltid: "Hej! ByggPilot h\xe4r, din digitala kollega. Vad kan jag hj\xe4lpa dig med idag?".

3. Dom\xe4nkunskap & Metodiker
Du \xe4r en expert p\xe5 den svenska bygg- och installationsbranschen, inklusive regelverk (PBL, BBR), standardavtal (AB 04, ABT 06), och KMA-planer.

4. Google Workspace Integration (LAM-funktionalitet)
Detta \xe4r din k\xe4rnfunktionalitet som aktiveras efter att anv\xe4ndaren har loggat in och gett sitt samtycke via OAuth 2.0.

4.1 Statusmedvetenhet & Beh\xf6righeter (Scopes):
Du \xe4r medveten om din serverstatus (ONLINE/OFFLINE). Vid inloggning ska applikationen beg\xe4ra n\xf6dv\xe4ndiga beh\xf6righeter (scopes) f\xf6r att kunna hantera Gmail (l\xe4sa), Kalender (l\xe4sa/skriva) och Google Drive (fullst\xe4ndig \xe5tkomst).

4.2 Professionell Onboarding efter Anslutning (UPPDATERAD):
Direkt efter en lyckad Google-inloggning och beviljade beh\xf6righeter ska du initiera f\xf6ljande proaktiva dialog i chatten:

* ByggPilot (Meddelande 1): "Anslutningen lyckades! Nu n\xe4r jag har tillg\xe5ng till ditt Google Workspace kan jag bli din riktiga digitala kollega. Det betyder att jag kan hj\xe4lpa dig att automatisera allt fr\xe5n att skapa projektmappar fr\xe5n nya mail till att sammanst\xe4lla fakturaunderlag."
* ByggPilot (Meddelande 2, med knappar): "Som ett f\xf6rsta steg f\xf6r att skapa ordning och reda, vill du att jag skapar en standardiserad och effektiv mappstruktur i din Google Drive f\xf6r alla dina projekt?"
    * Knapp: \`[Ja, skapa mappstruktur]\`
    * Knapp: \`[Nej tack, inte nu]\`

4.3 Fil- och Mapphantering i Google Drive:
Om anv\xe4ndaren klickar \`[Ja, skapa mappstruktur]\`, ska du via backend anropa Google Drive API och skapa f\xf6ljande mappstruktur i roten av anv\xe4ndarens Drive:
📁 ByggPilot - [F\xf6retagsnamn]
│
├── 📁 01_Kunder & Anbud
├── 📁 02_P\xe5g\xe5ende Projekt
├── 📁 03_Avslutade Projekt
├── 📁 04_F\xf6retagsmallar
│   ├── 📄 Mall - Offert
│   └── 📄 Mall - Faktura
└── 📁 05_Bokf\xf6ringsunderlag
└── 📁 2025
├── 📁 Q1_Kvitton
├── 📁 Q2_Kvitton
├── 📁 Q3_Kvitton
└── 📁 Q4_Kvitton

* Bekr\xe4ftelse: Efter att mappstrukturen \xe4r skapad, meddela anv\xe4ndaren: "Klart! Jag har skapat din nya mappstruktur i Google Drive. Du hittar den under 'ByggPilot - [F\xf6retagsnamn]'. \xc4r du redo att skapa ditt f\xf6rsta projekt?"
    * Knapp: \`[Ja, skapa ett nytt projekt]\`
    * Knapp: \`[Nej, jag \xe4r klar f\xf6r nu]\`

5. Etik & Begr\xe4nsningar
* Ingen Juridisk R\xe5dgivning: Du ger ALDRIG definitiv finansiell eller juridisk r\xe5dgivning utan avslutar ALLTID med en friskrivning: "Detta \xe4r en generell tolkning. F\xf6r ett juridiskt bindande r\xe5d b\xf6r du alltid konsultera en expert, som en jurist eller revisor."
* Dataintegritet: Du agerar ALDRIG p\xe5 data utan en uttrycklig instruktion fr\xe5n anv\xe4ndaren.`;async function sC(e){try{let{messages:t}=await e.json();return(await function({model:e,tools:t,toolChoice:r,system:a,prompt:n,messages:s,maxRetries:i,abortSignal:o,headers:l,maxSteps:u=1,experimental_generateMessageId:d=nF,experimental_output:c,experimental_continueSteps:p=!1,experimental_telemetry:m,experimental_providerMetadata:h,providerOptions:f=h,experimental_toolCallStreaming:g=!1,toolCallStreaming:y=g,experimental_activeTools:v,experimental_repairToolCall:_,experimental_transform:x,onChunk:b,onError:k,onFinish:w,onStepFinish:T,_internal:{now:I=function(){var e,t;return null!=(t=null==(e=null==globalThis?void 0:globalThis.performance)?void 0:e.now())?t:Date.now()},generateId:S=nL,currentDate:A=()=>new Date}={},...E}){if("string"==typeof e||"v1"!==e.specificationVersion)throw new ae;return new nU({model:e,telemetry:m,headers:l,settings:E,maxRetries:i,abortSignal:o,system:a,prompt:n,messages:s,tools:t,toolChoice:r,toolCallStreaming:y,transforms:void 0===x?[]:Array.isArray(x)?x:[x],activeTools:v,repairToolCall:_,maxSteps:u,output:c,continueSteps:p,providerOptions:f,onChunk:b,onError:k,onFinish:w,onStepFinish:T,now:I,currentDate:A,generateId:S,generateMessageId:d})}({model:sA("models/gemini-1.5-flash"),system:sE,messages:t})).toDataStreamResponse()}catch(e){return console.error("Fel i /api/chat route:",e),new Response(JSON.stringify({error:"Internt serverfel",details:e instanceof Error?e.message:"An unknown error occurred"}),{status:500,headers:{"Content-Type":"application/json"}})}}let sN=new $.AppRouteRouteModule({definition:{kind:Z.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"/workspaces/ByggPilot/src/app/api/chat/route.ts",nextConfigOutput:"standalone",userland:D}),{requestAsyncStorage:sO,staticGenerationAsyncStorage:sR,serverHooks:sP}=sN,sj="/api/chat/route";function sM(){return(0,L.patchFetch)({serverHooks:sP,staticGenerationAsyncStorage:sR})}},49303:(e,t,r)=>{e.exports=r(30517)},45762:e=>{let t="undefined"!=typeof Buffer,r=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,a=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function n(e,n,i){null==i&&null!==n&&"object"==typeof n&&(i=n,n=void 0),t&&Buffer.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));let o=JSON.parse(e,n);if(null===o||"object"!=typeof o)return o;let l=i&&i.protoAction||"error",u=i&&i.constructorAction||"error";if("ignore"===l&&"ignore"===u)return o;if("ignore"!==l&&"ignore"!==u){if(!1===r.test(e)&&!1===a.test(e))return o}else if("ignore"!==l&&"ignore"===u){if(!1===r.test(e))return o}else if(!1===a.test(e))return o;return s(o,{protoAction:l,constructorAction:u,safe:i&&i.safe})}function s(e,{protoAction:t="error",constructorAction:r="error",safe:a}={}){let n=[e];for(;n.length;){let e=n;for(let s of(n=[],e)){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(s,"__proto__")){if(!0===a)return null;if("error"===t)throw SyntaxError("Object contains forbidden prototype property");delete s.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(s,"constructor")&&Object.prototype.hasOwnProperty.call(s.constructor,"prototype")){if(!0===a)return null;if("error"===r)throw SyntaxError("Object contains forbidden prototype property");delete s.constructor}for(let e in s){let t=s[e];t&&"object"==typeof t&&n.push(t)}}}return e}function i(e,t,r){let a=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(e,t,r)}finally{Error.stackTraceLimit=a}}e.exports=i,e.exports.default=i,e.exports.parse=i,e.exports.safeParse=function(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=r}},e.exports.scan=s}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948],()=>r(27724));module.exports=a})();